# 二次互反律 - 五种表征

**创建日期**: 2025年12月1日
**领域**: 代数数论
**难度**: L2

---

## 元信息

| 属性 | 内容 |
|------|------|
| **定理** | 二次互反律 (Quadratic Reciprocity) |
| **领域** | 代数数论 |
| **发现者** | Gauss (1796) |
| **前置知识** | Legendre符号、同余 |

---

## 一、符号表征（形式化）

### 1.1 严格陈述

**二次互反律**：设p, q是不同的奇素数，则：

$$\left(\frac{p}{q}\right)\left(\frac{q}{p}\right) = (-1)^{\frac{p-1}{2} \cdot \frac{q-1}{2}}$$

其中 (p/q) 是Legendre符号。

### 1.2 等价形式

- 若 p ≡ q ≡ 1 (mod 4)，则 (p/q) = (q/p)
- 若 p ≡ q ≡ 3 (mod 4)，则 (p/q) = -(q/p)
- 否则 (p/q) = (q/p)

### 1.3 Lean 4 形式化

```lean
import Mathlib.NumberTheory.LegendreSymbol.QuadraticReciprocity

-- 二次互反律
theorem quadratic_reciprocity {p q : ℕ} [Fact p.Prime] [Fact q.Prime]
    (hp : p % 2 = 1) (hq : q % 2 = 1) (hpq : p ≠ q) :
    legendreSym p q * legendreSym q p =
    (-1 : ℤ) ^ ((p - 1) / 2 * ((q - 1) / 2)) := by
  exact legendreSym.quadratic_reciprocity hp hq hpq
```

---

## 二、几何表征（可视化）

### 2.1 格点计数

```text
计算 Σ_{x=1}^{(p-1)/2} ⌊qx/p⌋：

    q│      ∙∙∙∙∙
     │    ∙∙∙∙∙
     │  ∙∙∙∙∙
     │∙∙∙∙∙
     └────────────p

格点数 = (p-1)(q-1)/4 的奇偶性决定符号
```

### 2.2 对称性

```text
p×q矩形内的格点：
├─ 对角线上方：与 (p/q) 相关
├─ 对角线下方：与 (q/p) 相关
└─ 对称性给出互反律
```

---

## 三、直觉表征（类比）

### 3.1 一句话解释

> **二次互反律**："p是q的二次剩余"与"q是p的二次剩余"几乎等价，只差一个符号

### 3.2 镜子类比

- p看q：x² ≡ q (mod p) 有解？
- q看p：y² ≡ p (mod q) 有解？
- 互反律：两个问题的答案"几乎相同"

### 3.3 为什么重要？

把"q模p"的问题转化为"p模q"的问题，可能更容易计算

---

## 四、计算表征（算法）

### 4.1 Python实现

```python
def legendre_symbol(a, p):
    """计算Legendre符号 (a/p)"""
    if a % p == 0:
        return 0
    result = pow(a, (p - 1) // 2, p)
    return result if result == 1 else -1

def verify_quadratic_reciprocity(p, q):
    """验证二次互反律"""
    lhs = legendre_symbol(p, q) * legendre_symbol(q, p)
    rhs = (-1) ** (((p - 1) // 2) * ((q - 1) // 2))
    return lhs == rhs

# 验证
primes = [3, 5, 7, 11, 13, 17, 19, 23]
for i, p in enumerate(primes):
    for q in primes[i+1:]:
        result = verify_quadratic_reciprocity(p, q)
        print(f"p={p}, q={q}: {result}")
```

### 4.2 应用：计算Legendre符号

```python
def compute_legendre_fast(a, p):
    """使用互反律快速计算"""
    if a == 2:
        # 补充定律: (2/p) = (-1)^((p²-1)/8)
        return (-1) ** ((p * p - 1) // 8)
    if a == -1:
        # (-1/p) = (-1)^((p-1)/2)
        return (-1) ** ((p - 1) // 2)
    # 使用互反律递归
    a = a % p
    if a > p // 2:
        return compute_legendre_fast(p - a, p) * compute_legendre_fast(-1, p)
    return legendre_symbol(p % a, a) * (-1) ** (((p-1)//2) * ((a-1)//2))
```

---

## 五、范畴表征（抽象）

### 5.1 类域论视角

```text
二次互反律 = ℚ(√p) 和 ℚ(√q) 的分歧性质
├─ p在ℚ(√q)中分裂 ⟺ (q/p) = 1
├─ q在ℚ(√p)中分裂 ⟺ (p/q) = 1
└─ 互反律：两者的关系
```

### 5.2 推广

- **高次互反律**：n次剩余
- **Artin互反律**：类域论的核心
- **Langlands互反律**：更深层的推广

### 5.3 同调视角

Brauer群、Galois上同调给出互反律的现代解释

---

## 关联定理

| 定理 | 关系 |
|------|------|
| **Artin互反律** | 一般化 |
| **类域论** | 统一框架 |
| **Hilbert符号** | 局部版本 |

---

**状态**: ✅ 完成
