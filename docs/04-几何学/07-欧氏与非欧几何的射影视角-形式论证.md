# 欧氏与非欧几何为何本质上是射影几何的扩展——形式化论证（Cayley–Klein 视角）

## 0. 摘要 / Abstract

我们在射影几何的统一框架下，给出欧氏几何、双曲几何（非欧几何之一）与椭圆几何（另一类非欧几何）作为"带绝对（absolute）的射影几何"（Cayley–Klein 几何）的严格刻画。核心思想是：

- 选择射影空间中的一个（可能退化或虚的）二次曲线/二次曲面作为"绝对"，并考虑保持该绝对的射影变换群；
- 借助交比定义度量（Klein–Hilbert 型）与角度（通过对偶绝对），从而在同一射影语言下统一三大几何；
- 三类几何分别对应绝对的实型（双曲）、退化型（欧氏）、虚型（椭圆）三种情形，是"射影不变量 + 绝对"的扩展。

## 1. 射影预备 / Projective Preliminaries

### 1.1 定义（射影空间与交比）

- 射影空间：记 $\mathbf{P}^n(K)$ 为域 $K$ 上的 $n$ 维射影空间。
- 交比（Cross-Ratio）：对共线四点 $A,B;X,Y\in \mathbf{P}^1$，定义

$$
[A,B;X,Y] = \frac{(x-a)(y-b)}{(x-b)(y-a)}
$$
其中以任一仿射坐标表示，结果为射影不变量（坐标与参数化无关）。

### 1.2 定义（绝对与保持群）

- 绝对 $\mathcal{Q}$：$\mathbf{P}^n$ 中给定的二次曲线/二次曲面（在 $n=2$ 为圆锥曲线，在 $n\ge 3$ 为二次曲面），允许退化或无实点。
- 保持群 $\mathrm{Proj}(\mathcal{Q})$：所有将 $\mathcal{Q}$ 映到自身的射影变换（在矩阵表示下即保持相应二次型的 $\mathrm{PGL}$ 子群）。

## 2. Cayley–Klein 距离与测地线 / CK Distance and Geodesics

设 $\Omega \subset \mathbf{P}^n$ 为相对于绝对 $\mathcal{Q}$ 的"可度量域"（例如在 $n=2$，为 $\mathcal{Q}$ 的实内部区域，或相应退化/虚情形的合适开集）。给定直线 $\ell$ 与两点 $P,Q\in \Omega\cap \ell$，令 $X,Y=\ell\cap \mathcal{Q}$ 为与绝对的交点（计入可能的无穷远/复点，按对应情形讨论）。

### 2.1 定义（CK 距离）

在 $n=2$ 时（平面情形）定义
$$
 d_{\mathcal{Q}}(P,Q) = \frac{1}{2}\big|\log\,[X,Y;P,Q]\big|.
$$
更高维下取 $P,Q$ 所在的射影直线并同样用交比定义。该定义具有：

- 射影自然性：对任意 $g\in \mathrm{Proj}(\mathcal{Q})$，有 $d_{\mathcal{Q}}(gP,gQ)=d_{\mathcal{Q}}(P,Q)$。
- 几何意义：测地线为 $\Omega$ 内直线段（Beltrami–Klein 模型）。

### 2.2 定理（不变性与完备性，纲要）

- 不变性：$\mathrm{Proj}(\mathcal{Q})$ 等距地作用于 $(\Omega,d_{\mathcal{Q}})$。
- 测地线：$\Omega$ 中的测地线恰为射影直线与 $\Omega$ 的交。
- 三角不等式与度量公理在相应情形成立（双曲与椭圆严格成立；欧氏为退化极限情形，见 §3）。

（证明要点）交比在射影变换下不变，且绝对被保持，故由定义即得等距；测地线性质源于 Klein 模型的直线测地线特征。三角不等式可用 Hilbert 度量/支撑函数方法或经典 Klein–Hilbert 论证。

## 3. 三大几何的统一刻画 / Unification of Three Geometries

### 3.1 双曲几何（实非退化绝对）

取 $\mathcal{Q}$ 为实非退化二次曲线/曲面，其实内部 $\Omega$ 上的 $d_{\mathcal{Q}}$ 给出双曲度量（Beltrami–Klein 模型）。

- 等距群：$\mathrm{Proj}(\mathcal{Q}) \cong \mathrm{O}(1,n)$ 的射影像（保持绝对的洛伦兹型二次型）。
- 测地线：$\Omega$ 中弦线段；角度可由对偶绝对 $\mathcal{Q}^*$ 定义（Busemann 度量或角度交比）。

### 3.2 欧氏几何（退化绝对：无穷远"圆锥"）

取绝对 $\mathcal{Q}$ 为退化型——在 $\mathbf{P}^2$ 中是"无穷远圆"（由两虚圆点及无穷远直线退化而成），在高维为对应退化二次型：

- 距离为双曲/椭圆度量的退化极限，恢复欧氏距离（可由 Cayley 距离对绝对退化的极限推导，或采用绝对圆锥极限的 Blaschke–Klein 论证）。
- 等距群：保持退化绝对的射影群即欧氏等距群的射影实现（相似群/等距群出现在保持该退化构型及尺度的子群中）。
- 测地线：仍为直线；平行公设对应无穷远直线的存在（平行方向在无穷远会合）。

### 3.3 椭圆几何（无实点的虚绝对）

当绝对 $\mathcal{Q}$ 无实点（例如 $x_1^2+\cdots + x_{n+1}^2=0$ 仅有复点），实域下的"内部"即整个实射影空间，得到椭圆几何：

- 等距群：$\mathrm{Proj}(\mathcal{Q}) \cong \mathrm{PO}(n+1)$ 的射影像；
- 模型等价：与球面几何的反射/中心投影模型等价（识别对蹠点后得到实射影空间的椭圆度量）。

### 3.4 结论（Erlangen 纲领意义）

在 Klein 的 Erlangen 纲领框架中：

- "几何 = 不变量 + 变换群"。
- 选择绝对 $\mathcal{Q}$ 确定了允许的变换群 $\mathrm{Proj}(\mathcal{Q})$ 与相应不变量（距离、角度等），三大几何由此统一为"射影几何 + 绝对"的三种特例（实、退化、虚）。

## 4. 角度的射影刻画（对偶绝对） / Angle via Dual Absolute

### 4.1 定义（对偶绝对与角度）

记 $\mathcal{Q}^*$ 为 $\mathcal{Q}$ 的对偶二次曲线/曲面（在对偶射影空间中）。给定过一点的两条射影直线 $\ell_1,\ell_2$，以 $\ell_i$ 在对偶空间中的点 $L_i\in \mathbf{P}^{n*}$ 表示，令 $U,V= \mathcal{Q}^*\cap \overline{L_1L_2}$。定义
$$
 \angle(\ell_1,\ell_2)=\frac{1}{2}\big|\log\,[U,V;L_1,L_2]\big|,
$$
得到对 $\mathrm{Proj}(\mathcal{Q})$ 不变的角度测度。

### 4.2 定理（测地与角的相容性，纲要）

在上述三类情形中，角度定义与对应的距离相容，并在欧氏极限下退化为普通角度；在双曲与椭圆情形中与各自标准角度等距等价。

（证明思路）利用极线/极点对偶与保 $\mathcal{Q}$ 的射影变换对 $\mathcal{Q}^*$ 的作用，角度交比保持不变；再与标准模型（Poincaré/球面）之间的等距同构建立一致性。

## 5. 形式化小结 / Formal Summary

- 定义（绝对） + 定义（CK 距离/角度） + 保持群不变性 ⇒ 同一射影框架下统一三大几何；
- 双曲（实非退化绝对）、欧氏（退化绝对极限）、椭圆（虚绝对）三类情形分别由 $\mathcal{Q}$ 的类型区分；
- 因而"欧氏与非欧几何本质上是射影几何的扩展"可形式化为：射影几何经由选择绝对并限制为保持绝对的变换群后，赋予交比度量/角度，得到各几何的度量—测地结构与等距群。

## 6. 术语对照表 / Terminology Table

| 中文 | English |
|---|---|
| 绝对（二次曲线/曲面） | Absolute (quadric) |
| 保持群 | Preserving group (projective automorphisms fixing the absolute) |
| 交比 | Cross-ratio |
| Cayley–Klein 距离 | Cayley–Klein distance |
| Beltrami–Klein 模型 | Beltrami–Klein model |
| 对偶绝对 | Dual absolute |
| Erlangen 纲领 | Erlangen program |
| Hilbert 度量 | Hilbert metric |

## 7. 参考文献 / References

- Klein, F. (1872). Vergleichende Betrachtungen über neuere geometrische Forschungen.
- Cayley, A. (1859). A Sixth Memoir upon Quantics.
- Hilbert, D. (1895–1925). Grundlagen der Geometrie; Über die gerade Linie als kürzeste Verbindung zweier Punkte.
- Busemann, H. (1955). The Geometry of Geodesics. Springer.
- Ratcliffe, J. (2006). Foundations of Hyperbolic Manifolds. Springer.
- Berger, M. (1987). Geometry I & II. Springer.
- Stillwell, J. (1996). Sources of Hyperbolic Geometry. AMS.

## 8. 坐标化推导：CK 距离的显式公式（以单位圆/球为绝对）

### 8.1 平面（单位圆为绝对）

在 $\mathbf{P}^2$ 的仿射图中取单位圆
$$
\mathcal{Q}:\ x^2+y^2=1
$$
为绝对，其内部单位圆盘 $\mathbb{D}^2=\{p\in\mathbb{R}^2:\ \lVert p\rVert<1\}$ 为可度量域。对 $p,q\in\mathbb{D}^2$，取过 $p,q$ 的直线与 $\partial\mathbb{D}^2$ 的交点为 $x_\pm$（按 $p\to q$ 的方向先后记次序）。由交比定义得
$$
 d(p,q)=\tfrac12\Big|\log [x_+,x_-;p,q]\Big|=\tfrac12\log\frac{\lVert q-x_+\rVert\,\lVert p-x_-\rVert}{\lVert p-x_+\rVert\,\lVert q-x_-\rVert}.
$$
利用解析几何可消去 $x_\pm$ 得到闭式：
$$
 \cosh d(p,q)=\frac{1-\langle p,q\rangle}{\sqrt{(1-\lVert p\rVert^2)(1-\lVert q\rVert^2)}},\quad d(p,q)=\operatorname{arcosh}\Bigg(\frac{1-\langle p,q\rangle}{\sqrt{(1-\lVert p\rVert^2)(1-\lVert q\rVert^2)}}\Bigg).
$$
这与双曲空间的标准距离一致（Klein 模型）。

（推导要点）设直线参数化 $\gamma(t)=p+t(q-p)$，令 $\gamma(t_\pm)$ 触及单位圆，则 $\lVert p+t_\pm(q-p)\rVert^2=1$ 给出二次方程，解得 $t_\pm$，由交比 $[t_+,t_-;0,1]$ 直接化简即得上式。

### 8.2 高维（单位球为绝对）

在 $\mathbb{R}^n$ 中取单位球 $\mathbb{D}^n=\{x:\ \lVert x\rVert<1\}$ 为可度量域。相同计算给出
$$
 \cosh d(p,q)=\frac{1-\langle p,q\rangle}{\sqrt{(1-\lVert p\rVert^2)(1-\lVert q\rVert^2)}},\quad p,q\in\mathbb{D}^n.
$$
测地线为球内任一直线段；等距群为保持单位二次型 $x_1^2+\cdots+x_n^2-x_{n+1}^2$ 的 $\mathrm{PO}(1,n)$ 的射影像。

## 9. 欧氏极限与退化绝对（形式极限）

考虑缩放 $\varepsilon\in(0,1)$，令 $\mathbb{D}^n_\varepsilon=\{x:\ \lVert x\rVert<\varepsilon\}$，以单位公式在 $\mathbb{D}^n_\varepsilon$ 上定义距离。取 $p=\varepsilon u,\ q=\varepsilon v$ 固定 $u,v$，有
$$
 \cosh d(\varepsilon u,\varepsilon v)=\frac{1-\varepsilon^2\langle u,v\rangle}{\sqrt{(1-\varepsilon^2\lVert u\rVert^2)(1-\varepsilon^2\lVert v\rVert^2)}}
 =1+\tfrac{\varepsilon^2}{2}\lVert u-v\rVert^2+O(\varepsilon^4).
$$
于是
$$
 d(\varepsilon u,\varepsilon v)=\sqrt{\varepsilon^2\lVert u-v\rVert^2+O(\varepsilon^4)}=\varepsilon\,\lVert u-v\rVert+O(\varepsilon^3).
$$
将长度再按因子 $\varepsilon^{-1}$ 共同缩放（对应将绝对推送至"无穷远"），便得到极限欧氏距离 $\lVert u-v\rVert$。这给出"退化绝对"下欧氏几何作为 CK 几何的极限。

（群的极限）$\mathrm{PO}(1,n)$ 在 $\varepsilon\to 0$ 的 Inönü–Wigner 缩并极限为欧氏等距群 $\mathrm{E}(n)=\mathrm{O}(n)\ltimes\mathbb{R}^n$，与保持退化绝对的射影群一致。

## 10. 等距群的齐性—各向同性刻画

- 双曲情形：选择基点 $o=0\in\mathbb{D}^n$。稳定子 $\mathrm{Stab}(o)\cong\mathrm{O}(n)$（线性正交变换在 Klein 模型中为过 $o$ 的等距）。因此 $(\mathbb{D}^n,d)$ 为齐性空间

$$
 (\mathbb{D}^n,d)\cong \mathrm{PO}(1,n)/\mathrm{O}(n),
 $$
曲率常负。

- 椭圆情形：实射影空间配以虚绝对，得到

$$
 \mathbf{RP}^n\cong \mathrm{PO}(n+1)/\mathrm{O}(n+1),
 $$
曲率常正。

- 欧氏情形：退化极限给出

$$
 \mathbb{R}^n\cong \mathrm{E}(n)/\mathrm{O}(n),
 $$
曲率为零。

## 11. 角度的对偶描述与计算

记单位球对应的对偶绝对仍为单位球（自对偶）。设 $p\in\mathbb{D}^n$，两条过 $p$ 的直线方向向量为 $u,v$。在对偶空间中，直线对应点 $U,V$，取 $U,V$ 连线与对偶绝对的交点 $A,B$，角度为
$$
 \angle(u,v)=\tfrac12\big|\log [A,B;U,V]\big|.
$$
在单位球 Klein 模型中，该角度与通过等距映射到 Poincaré 球后所得的标准黎曼角度一致；在欧氏极限 $\varepsilon\to 0$ 下，上式一阶即退化为欧氏角。

（坐标化一例，二维）设 $p\in\mathbb{D}^2$，过 $p$ 的两条直线与单位圆的极线相交得到对偶交比，化简可得
$$
 \cos \angle(u,v)=\frac{\langle u,v\rangle-(\langle p,u\rangle\,\langle p,v\rangle)}{\sqrt{(\lVert u\rVert^2-\langle p,u\rangle^2)(\lVert v\rVert^2-\langle p,v\rangle^2)}},
 $$
与将 Klein 模型转入 Poincaré 模型后用标准角度计算结果一致。

## 12. 与 Hilbert 度量的关系

设 $\Omega\subset\mathbb{R}^n$ 为有界严格凸开集。Hilbert 度量定义为：对 $p\ne q\in\Omega$，直线 $pq$ 与边界 $\partial\Omega$ 的交点按顺序为 $a,b$，则
$$
 d_{H,\Omega}(p,q)=\tfrac12\log [a,b;p,q].
 $$
当 $\partial\Omega$ 为二次曲面（即取 $\Omega$ 为绝对的"内部"）时，$d_{H,\Omega}$ 正是 Cayley–Klein 距离，因此 CK 几何是 Hilbert 度量在二次边界情形的黎曼型特例；一般凸域则给出 Finsler 型几何。

（Finsler 范数）在 $\Omega$ 的点 $p$ 和切向量 $v\ne 0$，令沿 $\pm v$ 方向与边界的交参数为 $\alpha,\beta>0$（即 $p\pm\alpha v,\ p-\beta v\in\partial\Omega$），则 Hilbert 度量诱导的 Finsler 范数为
$$
 \lVert v\rVert_{H,p}=\tfrac12\Big(\alpha^{-1}+\beta^{-1}\Big)\lVert v\rVert_{\text{Euc}}.
 $$
在二次边界情形，上式等价于 Klein 模型的黎曼度量张量。

## 13. 练习与例题

1) 证明 8.1 中二维闭式公式：由 $t_\pm$ 的二次方程显式解出交比，化简得 $\cosh d$ 的点积表达式。

2) 设 $g\in\mathrm{PO}(1,n)$ 的射影像作用于 $\mathbb{D}^n$。证明 $g$ 等距，并求其在 Klein 坐标中的显式矩阵分解（Lorentz–SVD）。

3)（欧氏极限）按第 9 节设 $p=\varepsilon u,\ q=\varepsilon v$。证明 $\varepsilon^{-1}d(\varepsilon u,\varepsilon v)\to \lVert u-v\rVert$，并说明相应等距群的极限为 $\mathrm{E}(n)$。

4)（角度与对偶）在二维单位圆情形，给出过点 $p$ 的直线的极线表达式，完成 11 节角度余弦公式的推导。

5)（Hilbert 度量）在椭圆域 $\Omega=\{x:\ x^\top A x<1\}$ 中，证明 $d_{H,\Omega}$ 与由 $A$ 给出的 CK 度量一致，并写出度量张量在原点处的矩阵形式。

## 14. Klein↔Poincaré 模型的等距互换

设 $k\in\mathbb{D}^n$ 表示 Klein（Beltrami）模型坐标，$u\in\mathbb{D}^n$ 表示 Poincaré 球模型坐标，则二者存在径向等距互换：

- Klein → Poincaré：

$$
 u=\frac{k}{1+\sqrt{1-\lVert k\rVert^2}}\ =\ \Bigg(\frac{1-\sqrt{1-\lVert k\rVert^2}}{\lVert k\rVert^2}\Bigg)\,k\quad(\text{当 }k\ne 0).
 $$

- Poincaré → Klein：

$$
 k=\frac{2u}{1+\lVert u\rVert^2}.
 $$

该映射把 Klein 中的测地直线（弦）送到 Poincaré 中与边界球正交的圆（或直径）。Poincaré 模型保角，Klein 模型保直线测地；二者由上式等距同构，距离相同而角度表现不同。

## 15. Klein 模型中的度量张量与测地

在单位球 Klein 模型中，黎曼度量可直接在仿射坐标 $x\in\mathbb{D}^n$ 写为
$$
 g_x(v,w)=\frac{\langle v,w\rangle}{1-\lVert x\rVert^2}+\frac{\langle x,v\rangle\,\langle x,w\rangle}{(1-\lVert x\rVert^2)^2}

 =\ v^\top\Bigg(\frac{(1-\lVert x\rVert^2)\,I + x x^\top}{(1-\lVert x\rVert^2)^2}\Bigg)w.
 $$
由此可验证：

- 测地为欧式直线段（与第 2 节一致）。
- 截面曲率常数为 $-1$（与双曲空间一致）。
- 通过第 14 节与 Poincaré 度量 $\displaystyle g^{\text{Poi}}_u = \frac{4\, \mathrm{d}u\cdot\mathrm{d}u}{(1-\lVert u\rVert^2)^2}$ 的坐标互换可相互推出。

（提示）从双叶双曲面模型通过中心投影到 Klein 模型，拉回 Minkowski 度量得到上式；或由 Klein↔Poincaré 映射对 Poincaré 度量作拉回计算得到。

## 16. 拓展方向与进一步参考

- 更广义的 CK 几何：改变绝对的符号型与实/虚/退化情形，可得到椭圆、双曲、欧氏以及带时空符号的 de Sitter/anti-de Sitter 等伪黎曼几何。
- 一般凸域的 Hilbert 几何：当边界非二次曲面时得到 Finsler 几何，许多性质（如负曲率型、测地行为、体积增长）在 Benoist 等人的工作中有系统刻画。
- 模型比较：
  - Klein 模型：测地为直线，非保角；
  - Poincaré 球/半平面：保角，测地为与边界正交的圆/直线；
  - 双曲面模型：群作用线性、计算方便。

补充参考：

- Papadopoulos, A., Troyanov, M. (eds.) (2014). Handbook of Hilbert Geometry. European Math. Society.
- de la Harpe, P. (1990). Topics in Geometric Group Theory. (双曲背景章节)。
- Benoist, Y. (2003–2010). Convex divisible sets and Hilbert geometry（系列论文）。

## 17. 极点—极线与对偶二次曲面的线性代数表述

设绝对由对称矩阵 $A\in\mathrm{Sym}_{n+1}(\mathbb{R})$ 给出：在齐次坐标 $X=[x:1]$（或一般 $[X] \in \mathbf{P}^n$）中，二次曲面为
$$
 \mathcal{Q}=\{[X]\in\mathbf{P}^n:\ X^\top A X=0\}.
 $$

- 极线/极超平面：对点 $[X]$（若 $X\notin\mathcal{Q}$），其极超平面为

$$
 H_X=\{[Y]:\ X^\top A Y=0\}.
 $$

- 对偶绝对：在对偶射影空间中，对偶二次曲面为

$$
 \mathcal{Q}^*=\{[\ell]:\ \ell^\top A^{-1}\ell=0\}\quad(\text{若 }A\text{ 非退化}).
 $$
退化情形下以广义逆或秩亏表示。射影变换 $g\in\mathrm{PGL}_{n+1}$ 保持 $\mathcal{Q}$ 等价于存在标量 $\lambda\ne 0$ 使得
$$
 g^\top A g=\lambda A.
 $$
因此 $g$ 对极性保持（从而保持角度与 CK 距离）。

## 18. 体积元素与曲率（Klein 模型）

在单位球 Klein 模型，度量张量见第 15 节。其行列式满足
$$
 \det g_x = (1-\lVert x\rVert^2)^{-(n+1)},\quad x\in\mathbb{D}^n,
 $$
故黎曼体积元为
$$
 \mathrm{d}\mathrm{vol}_K(x)=\frac{\mathrm{d}x}{(1-\lVert x\rVert^2)^{\frac{n+1}{2}}}.
 $$
截面曲率恒为 $-1$。在 Poincaré 球模型中则有
$$
 \mathrm{d}\mathrm{vol}_P(u)=\Big(\frac{2}{1-\lVert u\rVert^2}\Big)^{\!n}\,\mathrm{d}u,
 $$
二者由第 14 节坐标互换相关。

（边界行为）当 $\lVert x\rVert\to 1^-$ 时体积密度发散，反映双曲空间向边界的无限延伸。

## 19. 三角形面积与角缺（Gauss–Bonnet 在 CK 视角）

- 双曲平面（曲率 $-1$）：任意测地三角形面积满足

$$
 \operatorname{Area}=\pi-(\alpha+\beta+\gamma),
 $$
其中 $\alpha,\beta,\gamma$ 为内角。Klein 模型中测地为直线段，但角度应以第 11 节的对偶绝对角度计算，结果与 Poincaré 模型一致。

- 椭圆（球面识对蹠）：

$$
 \operatorname{Area}= (\alpha+\beta+\gamma)-\pi
 $$
（单位曲率）。

- 欧氏（曲率 $0$）为极限：面积与角和 $\pi$ 无关（角缺为零）。

上述为二维 Gauss–Bonnet 的特例：$\int_\triangle K\,\mathrm{d}A + \sum \text{外角}=\pi$，在常曲率情形直接化为角缺/盈余公式。

## 20. 与上半平面模型的联系（Cayley 变换）

在二维复坐标下，Poincaré 圆盘 $\mathbb{D}=\{z:\ |z|<1\}$ 与上半平面 $\mathbb{H}=\{w:\ \Im w>0\}$ 由 Cayley 变换等距：
$$
 w= i\,\frac{1+z}{1-z},\qquad z=\frac{w-i}{w+i}.
 $$
高维下通过正交共轭将某一坐标化为"复数轴"，并在每条二维复切片上施行上述变换得到球—半空间的等距同构。合成第 14 节 Klein↔Poincaré 互换，即得 Klein 模型到上半空间模型的显式等距构造。

（群对应）圆盘模型中 $\mathrm{PO}(1,2)$ 的等距对应于上半平面中的 $\mathrm{PSL}(2,\mathbb{R})$ 的 Möbius 作用；高维对应为保界球/边界超平面的共形群作用。

## 21. 无穷远边界与可视度量（Boundary at Infinity）

- 绝对即为理想边界：在 Klein 模型中，单位球的边界 $\partial\mathbb{D}^n$ 即双曲空间的理想边界 $\partial_\infty \mathbb{H}^n$，与双曲面模型的光锥截面同构 $\partial_\infty \mathbb{H}^n\cong \mathbb{S}^{n-1}$。
- 可视度量与交比：对边界三点 $\xi,\eta,\zeta\in\partial_\infty$，以基点 $o$ 定义可视度量（或 Gromov 乘积）

$$
 (\xi|\eta)_o = \lim_{t\to\infty} \tfrac12\big(d(o,\gamma_\xi(t))+d(o,\gamma_\eta(t))-d(\gamma_\xi(t),\gamma_\eta(t))\big),
 $$
并据此得到等价的可视度量族。对边界四点可定义交比
$$
 [\xi,\eta;\zeta,\omega]=\exp\big( (\xi|\zeta)_o+(\eta|\omega)_o-(\xi|\omega)_o-(\eta|\zeta)_o\big),
 $$
与射影交比一致，独立于 $o$，且为等距不变量。

## 22. Busemann 函数与测地视界（Horospheres）

- Busemann 函数：对边界点 $\xi\in\partial_\infty$ 与参考点 $o$，定义

$$
 b_\xi(x)=\lim_{t\to\infty}\big(d(x,\gamma_\xi(t))-d(o,\gamma_\xi(t))\big).
 $$

- 等位曲面为测地视界（horospheres），在 Klein 模型中其等位集对应于与绝对相切的一族二次曲线/曲面；等位域（horoballs）为其内部。
- 与 Hilbert 几何：对一般严格凸域 $\Omega$，Busemann 函数依然通过支撑函数刻画；当边界为二次曲面时退化为双曲情形的黎曼 Busemann 结构。

## 23. 反射生成与极性（Cartan–Dieudonné）

- 对称反射：在双曲空间中，关于某测地超平面的反射对应于 Minkowski 空间中关于相应时间样超平面的 Lorentz 反射，其射影像保持绝对。
- 定理（Cartan–Dieudonné）：$\mathrm{O}(1,n)$ 中任意等距可表示为有限个（至多 $n+1$ 个）反射之积。由极性 $X\mapsto H_X$（第 17 节）可将反射理解为以绝对为参考的极线/极点对偶操作。
- Klein 模型中的构造：给定超平面由仿射方程 $u\cdot x=c$ 描述，其反射在 Klein 坐标中为分式线性变换，矩阵满足 $g^\top A g=A$。

## 24. 双曲面模型的闭式与与 Klein 的桥接

- 双曲面模型：在 $\mathbb{R}^{n,1}$ 的 Lorentz 内积 $\langle X,Y\rangle_L = -X_0Y_0+X_1Y_1+\cdots+X_nY_n$ 下，取

$$
 \mathbb{H}^n=\{X:\ \langle X,X\rangle_L=-1,\ X_0>0\}.
 $$
距离为
$$
 \cosh d(X,Y)=-\langle X,Y\rangle_L.
 $$

- 到 Klein 的中心投影：令仿射超平面 $X_0=1$，投影 $\pi: X\mapsto x=\frac{1}{X_0}(X_1,\dots,X_n)$ 得 Klein 坐标 $x\in\mathbb{D}^n$。反之，给定 $x\in\mathbb{D}^n$，可取

$$
 X=\frac{1}{\sqrt{1-\lVert x\rVert^2}}\,(1,x)
 $$
使得 $\pi(X)=x$。代入 $-\langle X,Y\rangle_L$ 即得第 8 节的 Klein 闭式。

## 25. 测地极坐标与体积增长

- 测地极坐标：以 $o\in\mathbb{H}^n$ 为中心，$x=(r,\theta)$，度量写成

$$
 \mathrm{d}s^2=\mathrm{d}r^2+\sinh^2 r\,\mathrm{d}\theta^2_{\mathbb{S}^{n-1}},\quad r\ge 0.
 $$

- 体积与面积：

$$
 \operatorname{Area}(\mathbb{S}_r)=\omega_{n-1}\,\sinh^{n-1} r,\qquad \operatorname{Vol}(B_r)=\omega_{n-1}\int_0^r \sinh^{n-1} t\,\mathrm{d}t.
 $$
指数增长反映负曲率几何特征。与第 18 节 Klein 体积元在坐标变换下一致。

- 等周不等式：双曲空间中的等周曲面趋向于测地球面，且体积—表面积关系与欧氏、球面情形不同（参考 Anderson 等）。

## 26. 离散群、基本域与射影多面体

- Fuchsian/Kleinian 群：取 $\Gamma\subset\mathrm{PO}(1,n)$ 离散作用，则 $M=\mathbb{H}^n/\Gamma$ 为双曲流形/轨道空间。Klein 模型中基本域常可取为凸多面体，面对测地超平面。
- Dirichlet 域：以 $o\in\mathbb{H}^n$，定义

$$
 D(o)=\{x:\ d(x,o)\le d(x,\gamma o),\ \forall\gamma\in\Gamma\},
 $$
其像在 Klein 模型中是由有限个测地半空间交给出的凸体。

- 凸余维与 Hilbert 几何：对一般严格凸域 $\Omega$，取 $\Gamma\subset\mathrm{Aut}(\Omega)$ 离散作用，可形成 Hilbert 几何的可除集与商空间；当边界为二次曲面时退化为 CK/双曲情形。

## 27. Jacobi 场与指数映射（Klein 视角）

- 测地线：Klein 模型中测地为欧式直线段 $\gamma(t)=x_0+t v$（参数与弧长非线性）。
- 连接与曲率：尽管测地"是直线"，Levi–Civita 连接非平凡。常曲率 $-1$ 导致沿测地的横向 Jacobi 场满足

$$
 J''(t)-J(t)=0\quad(\perp \dot\gamma),\qquad J''(t)=0\quad(\parallel \dot\gamma).
 $$

- 指数与平行移动：在双曲面模型上计算更简洁：

$$
 \exp_X(tv)=\cosh t\,X+\sinh t\,\frac{V}{\lVert V\rVert_L},\ \ V\in T_X\mathbb{H}^n,\ \langle V,V\rangle_L=\lVert V\rVert_L^2.
 $$
与第 24 节中心投影合成可得 Klein 模型中的指数映射。

## 28. 凸性、最近点投影与 1-Lipschitz 性

- 射影/欧式凸性一致：Klein 模型中"测地凸"⇔"欧式凸"。
- 最近点投影：到闭测地凸集 $C$ 的最近点投影 $\pi_C$ 在双曲度量下是 $1$-Lipschitz；在 Klein 坐标中可通过直线参数与 CK 弧长关系实现数值投影。
- 半空间与支持超平面：测地半空间为欧式半空间，与第 23 节反射对应；支持超平面给出 Hilbert/Finsler 支撑函数的 CK 特例。

## 29. 比较几何：CAT($-1$) 与 Gromov 超曲率

- 常曲率 $-1$ 的双曲空间是 CAT($-1$) 空间，任意三角形 $\triangle$ 比较不等式对 $\mathbb{H}^2$ 成立。
- 薄三角性质：存在 $\delta>0$ 使每个三角形为 $\delta$-薄，$\mathbb{H}^n$ 为 Gromov 超曲率空间；边界 $\partial_\infty\mathbb{H}^n$ 配可视度量定义的拟共形类与第 21 节一致。
- 群论联系：离散等距群 $\Gamma$ 若共紧或有限体积，则 $\Gamma$ 为 Gromov 超曲率群，其 Cayley 图的边界拟等价于 $\partial_\infty (\mathbb{H}^n/\Gamma)$ 的提升。

## 30. 实用计算配方（Klein/双曲面/Poincaré）

- 距离（Klein，单位球）：

$$
 \cosh d(p,q)=\frac{1-\langle p,q\rangle}{\sqrt{(1-\lVert p\rVert^2)(1-\lVert q\rVert^2)}}.
 $$

- 反射（Klein）：设单位外法向 $u$ 与常数 $c$ 定义超平面 $H=\{x:\ u\cdot x=c\}$，对应矩阵满足 $g^\top A g=A$；在双曲面模型中为 Lorentz 反射 $R(Z)=Z-2\frac{\langle Z,N\rangle_L}{\langle N,N\rangle_L}N$。
- 模型变换：
  - Klein→Poincaré：$\displaystyle u=\frac{k}{1+\sqrt{1-\lVert k\rVert^2}}$；
  - Poincaré→Klein：$\displaystyle k=\frac{2u}{1+\lVert u\rVert^2}$；
  - 圆盘↔半平面（二维）：$\displaystyle w=i\frac{1+z}{1-z}$，$\displaystyle z=\frac{w-i}{w+i}$。
- 采样：按体积在球模型采样可使用 Poincaré 坐标的半径分布密度 $f(r)\propto \sinh^{n-1} r$，再映回 Klein。

## 31. 进阶练习

1) 在双曲面模型上推导 Jacobi 方程并证明横向解形如 $J(t)=a\,\sinh t+b\,\cosh t$；据此给出体积元素的指数增长。

2) 设 $C\subset\mathbb{D}^n$ 欧式凸，证明到 $C$ 的最近点投影在 CK 度量下 $1$-Lipschitz，并给出 Klein 参数化下的数值算法（提示：分段线性近似测地并使用弧长单调）。

3) 证明 $\mathbb{H}^n$ 为 CAT($-1$)，并计算 $\delta$-薄常数在二维情形的定量界；给出一个非凸域的 Hilbert 度量不满足 CAT($\kappa$) 的例子。

4) 写出通过一条测地的反射在 Klein 与双曲面模型中的显式矩阵，并验证它们在第 14/24 节的互换下共轭等价。

## 32. 术语与符号索引（补充）

- **极性（polarity）**：$X\mapsto H_X=\{Y:\ X^\top A Y=0\}$；对偶绝对 $\mathcal{Q}^*$ 满足 $\ell^\top A^{-1}\ell=0$。
- **测地视界（horosphere/horoball）**：Busemann 函数等位集/子水平集。
- **可视度量（visual metric）**：借基点定义于 $\partial_\infty$ 的拟等价度量族；与边界交比兼容。
- **CAT($\kappa$)**：比较几何条件；$\mathbb{H}^n$ 为 CAT($-1$)。
- **等距群分解**：$\mathbb{H}^n\cong \mathrm{PO}(1,n)/\mathrm{O}(n)$，欧氏与椭圆情形见第 10 节。

## 33. 一般二次型绝对下的 CK 闭式公式与归一化

设绝对由非退化对称矩阵 $A\in\mathrm{Sym}_{n+1}$ 给出，取仿射图并用齐次坐标 $X=(x,1)$ 表示点 $x\in\Omega$ 的提升。定义双线性型
$$
 \langle X,Y\rangle_A:= X^\top A Y.
 $$
当 $\mathcal{Q}$ 为实非退化且 $\Omega$ 取其"内部"时，有号约定使得 $-\langle X,X\rangle_A>0$。则 Cayley–Klein 距离的闭式为
$$
 \cosh d(x,y)=\frac{-\langle X,Y\rangle_A}{\sqrt{\big(-\langle X,X\rangle_A\big)\big(-\langle Y,Y\rangle_A\big)}}.
 $$
这与双曲面模型 $\cosh d(X,Y)=-\langle X,Y\rangle_L$ 完全平行。若 $A$ 退化或虚，对应退化/椭圆情形按极限/全域解释（见第 3 节）。

（归一化）存在可逆线性变换 $T\in\mathrm{GL}_{n+1}$ 使 $T^\top A T=\mathrm{diag}(I_n,-1)$。在仿射图中诱导 $x\mapsto \tilde x$ 的仿射变换，将一般绝对归一到单位球情形；距离与角度可在归一化后按第 8、15 节公式计算再映回。

## 34. 等距的分类与不动点结构（Klein 视角）

设 $g\in\mathrm{PO}(1,n)$ 的射影作用在 Klein 模型上：

- **椭圆型（elliptic）**：在 $\mathbb{D}^n$ 内有不动点（稳定某点的紧子群），等价于在双曲面模型中为时空旋转；射影矩阵有界谱，边界无实特征不动点对。
- **双曲型（hyperbolic/loxodromic）**：在边界上有两个不动点（吸引/排斥），在域内存在唯一测地轴，沿轴为平移+可能旋转；距离位移为平移长度。
- **抛物型（parabolic）**：在边界上有唯一不动点，无轴，生成测地视界的稳定；典型为"沿边界切向"的剪切。

在齐次坐标中可通过代表矩阵的 Jordan–Cartan 分解或极分解识别类型；其与第 23 节反射生成相容。

## 35. 数值实现与鲁棒性要点

- **边界交点求解**：弦与二次曲面交由一元二次方程给出，避免退化时使用伴随矩阵或 SVD 稳定计算；对近切情形使用稳健求根（Kahan 公式）。
- **交比稳定**：对 $[a,b;p,q]$ 采用对数与 `log1p` 技巧：使用
  $\displaystyle d=\tfrac12\big|\log [a,b;p,q]\big|=\tfrac12\big|\log \Delta\big|$，在 $\Delta\approx 1$ 时以 `log1p(\Delta-1)` 计算。
- **$\operatorname{arcosh}$ 稳定**：使用 $\operatorname{arcosh}(z)=\log\big(z+\sqrt{z^2-1}\big)$，并先钳制 $z\leftarrow\max(z,1)$；对小距离使用级数 $\operatorname{arcosh}(1+\epsilon)\approx \sqrt{2\epsilon}$。
- **仿射归一化**：优先将一般 $A$ 归一到单位球再计算，减少病态条件；数值上保存并使用 $T$ 与 $T^{-\top}$ 同步更新对偶数据（角度/极性）。
- **向量化**：批量距离可采用 $-X^\top A Y$ 的矩阵形式，配合归一化因子逐元素处理。

## 36. 案例：椭球绝对的距离与角度（仿射归一化）

设在仿射图中绝对为椭球域 $\Omega=\{x:\ (x-c)^\top B (x-c)<1\}$，其中 $B\succ 0$，其齐次矩阵可取
$$
 A=\begin{pmatrix}
 B & -B c\\
 -c^\top B & c^\top B c - 1
 \end{pmatrix}.
 $$

- 归一化：取 Cholesky/特征分解 $B=R^\top R$，令 $y=R(x-c)$，则域化为单位球；对点 $p,q$ 先变换到 $y_p,y_q$，用第 8 节公式算 $d(y_p,y_q)$，作为 $d(p,q)$。
- 角度：对偶绝对矩阵为 $A^{-1}$（或广义逆），在对偶空间中以同样归一化进行角度交比计算（第 11 节）。
- 实作小结：
  - 预计算 $R,c$；
  - 统一采用单位球配方（距离、测地、体积元）；
  - 需要在原坐标绘制测地时，使用直线在 $x$-域的表示与椭球交点回代参数。

## 37. 李群与李代数：$\mathrm{PO}(1,n)$ 的 $KAN$ 分解与流

- 李代数分解：$\mathfrak{so}(1,n)=\mathfrak{k}\oplus\mathfrak{a}\oplus\mathfrak{n}$，其中
  - $\mathfrak{k}\cong\mathfrak{so}(n)$（稳定基点的各向同性代数），
  - $\mathfrak{a}\cong\mathbb{R}$（沿某测地的"轴"方向），
  - $\mathfrak{n}\cong\mathbb{R}^{n-1}$（抛物子代数，稳定某理想边界点）。
- Iwasawa 分解：$\mathrm{PO}(1,n)=KAN$。几何意义：
  - $K$ 作用为围绕基点的旋转；
  - $A$ 生成测地平移（双曲"伸缩"）；
  - $N$ 生成以某边界点为定点的抛物等距（horosphere 方向）。
- 流：
  - 测地流由 $A$ 的右作用给出；
  - horocycle/horosphere 流由 $N$ 作用给出；
  - Busemann 函数与 $A\!N$ 坐标的关系：$b_\xi$ 等位集合与 $N$ 轨道重合，$A$ 沿法向改变等位值。

（二维示例）$\mathrm{PSL}(2,\mathbb{R})=KAN$，取
$$
 K=\left\{\begin{pmatrix}\cos\theta&\sin\theta\\-\sin\theta&\cos\theta\end{pmatrix}\right\},\quad
 A=\left\{\begin{pmatrix}e^{t/2}&0\\0&e^{-t/2}\end{pmatrix}\right\},\quad
 N=\left\{\begin{pmatrix}1&s\\0&1\end{pmatrix}\right\}.
 $$

## 38. 相对论速度空间与 Klein 模型（快度=距离）

设光速归一 $c=1$。在 Klein 单位球中以向量 $v$ 表示速度（$\lVert v\rVert<1$）。第 8 节给出
$$
 d(0,v)=\operatorname{arcosh}\frac{1}{\sqrt{1-\lVert v\rVert^2}}=\operatorname{artanh}\lVert v\rVert =: \varphi,
 $$
其中 $\varphi$ 为快度（rapidity）。两速度间的"相对快度"即双曲距离。速度合成对应双曲等距的组合：

- Klein 模型中的爱因斯坦合成可理解为沿测地的平移（$A$）合并与绕轴旋转（$K$），形成 loxodromic 等距；
- 在 Poincaré 球中则对应 Ungar 的"gyro 向量空间"结构（Möbius 加法）。

物理解释：Minkowski 空间的洛伦兹变换在双曲面模型线性作用，其射影像在 Klein/圆盘模型上给出速度空间的几何。

## 39. 二基本形式与典型等曲面（双曲曲率 $-1$）

- 测地球面（半径 $r$）：主曲率皆为 $\coth r$，均匀膨胀；面积 $\omega_{n-1}\sinh^{n-1} r$（见第 25 节）。
- 测地视界（horosphere）：主曲率恒 $1$（完全等曲）；等位与 $N$-轨道一致（第 37 节）。
- 等距于全测地超平面的平行超曲面（距 $r$）：主曲率恒 $\tanh r$，为等曲嵌入。

在 Klein 模型中，上述超曲面在欧式意义下分别为球、与绝对相切的二次曲面、与某测地超平面平行的二次曲面。

## 40. 代数几何视角：实二次型的分类与极性映射

- 分类（实域）：按签名 $(p,q)$ 将二次型分为椭圆型（无实点，椭圆几何）、双曲型（有实内部，双曲几何）、退化型（欧氏极限）。
- 极性映射：$[X]\mapsto H_X$ 给出 $\mathbf{P}^n\dashrightarrow (\mathbf{P}^n)^*$ 的双有理映射；在 $\mathcal{Q}$ 的外部与内部分别诱导对偶域。
- 不变量：
  - $g^\top A g=\lambda A$ 描述保持群；
  - 角度/距离由 $A$ 与 $A^{-1}$ 的配对交比给出（第 11、33 节）。
- 退化极限：签名改变或秩降至 $n$，得到欧氏几何的"无穷远绝对"（直线/圆锥退化）。

## 41. 关键证明纲要（细节附录）

- 交比→距离闭式：沿弦参数 $\gamma(t)=p+t(q-p)$，解与绝对的交参数 $t_\pm$，计算 $[t_+,t_-;0,1]$ 并化简至第 8 节闭式。
- 三角不等式：Hilbert 度量在严格凸域上为度量；二次边界情形下 CK=Hilbert，遂承袭三角不等式。亦可用 Busemann 函数与支撑超平面证。
- 测地直线性：Hilbert 度量测地为弦；二次边界情形退化到 Klein 模型中的直线段。
- 角度一致性：对偶绝对的交比角在 Klein↔Poincaré 等距下与标准黎曼角一致（第 14、15 节的拉回运算）。

## 42. 项目建议与进一步探索

1) 数值库：实现一般椭球绝对下的 CK 距离/测地/角度（第 33、36 节），并提供到 Poincaré/半平面模型的一键变换（第 14、20 节）。
2) 凸域 Hilbert 几何：比较不同边界光滑度下测地与体积增长的变化，验证 CAT 条件可能失效的例子（第 12、29 节）。
3) 离散群可视化：在 Klein 模型中用反射生成 Fuchsian/Kleinian 群，绘制 Dirichlet 域与极限集（第 23、26 节）。
4) 相对论应用：实现速度合成与快度可视化，展示等距与群分解在动力学中的几何意义（第 38、37 节）。

## 43. 射影基本定理与交比唯一性（保持绝对的限制）

- 射影基本定理：$n\ge 2$ 时，任意将直线映为直线的双射由某线性自同构的射影像给出。因而"保持绝对"的条件可在矩阵层面表述为 $g^\top A g=\lambda A$（第 17、33 节）。
- 交比唯一性：在 $\mathbf{P}^1$ 上，交比是唯一的非平凡射影不变量。CK 距离与角度均还原为交比（或对偶交比）的对数函数，因此其射影自然性由基本定理与交比唯一性共同保障。
- 群与不变量配对：选择绝对 $\mathcal{Q}$ 后，$\mathrm{Proj}(\mathcal{Q})$ 与由 $A$ 与 $A^{-1}$ 构造的（对偶）交比共同生成"距离—角度"全部不变量（见第 11、33 节）。

## 44. 极线—角平分与调和束

- 极线刻画角平分：在 Klein 模型中，过点 $p$ 的两条测地 $\ell_1,\ell_2$ 的角平分线可由对偶空间直观刻画：取 $\ell_i$ 的对偶点 $L_i$，连线 $L_1L_2$ 与对偶绝对的交点 $U,V$ 给出角度交比；令 $M$ 为使 $[U,V;L_1,M]=[U,V;M,L_2]$ 的调和条件，则 $M$ 对偶回原空间即角平分线的射影像。
- 调和四点与反射：$[A,B;C,D]=-1$ 的调和关系在极性下对应关于极线的反射；这与第 23 节反射生成兼容。
- Apollonius 轨迹（CK 版）：固定两点 $p,q$，集合 $\{x:\ d(x,p)-d(x,q)=\text{常数}\}$ 在 Klein 坐标下为圆锥截线（horosphere 或等距曲面的平移），与欧氏 Apollonius 圆在欧氏极限一致（第 9 节）。

## 45. 双曲三角公式（Klein 坐标下的计算）

设三角形内角为 $\alpha,\beta,\gamma$，对边弧长为 $a,b,c$。标准双曲三角恒等式：

- 余弦定理：

$$
 \cosh c=\cosh a\,\cosh b-\sinh a\,\sinh b\,\cos \gamma.
 $$

- 正弦定理：

$$
 \frac{\sin \alpha}{\sinh a}=\frac{\sin \beta}{\sinh b}=\frac{\sin \gamma}{\sinh c}.
 $$

- 角缺—面积：$\operatorname{Area}=\pi-(\alpha+\beta+\gamma)$（第 19 节）。

在 Klein 模型中，边为弦，可先以第 8 节公式求 $a,b,c$，角度以第 11 节对偶绝对交比求得，然后代入上述恒等式。数值上应使用稳定的 $\operatorname{arcosh}$ 实现（第 35 节）。

## 46. Klein 度量张量的多路推导（提纲）

- 双曲面拉回：由嵌入 $\iota: \mathbb{D}^n\to\mathbb{H}^n\subset\mathbb{R}^{n,1}$，$x\mapsto X=(1,x)/\sqrt{1-\lVert x\rVert^2}$，拉回 Lorentz 度量得第 15 节的 $g_x$。
- Hilbert/Finsler 极限：单位球作为严格凸域，其 Hilbert Finsler 范数在各向同性下产生黎曼化，微分后得到同一 $g_x$。
- Poincaré 拉回：利用第 14 节映射 $k\mapsto u(k)$，由 $g^{\text{Poi}}_u=\frac{4\,\mathrm{d}u\cdot\mathrm{d}u}{(1-\lVert u\rVert^2)^2}$ 拉回可得 $g_x$ 的等价表示。

## 47. CK 几何中的算法与应用要点

- 最近点与投影：到测地凸集的投影可通过（i）在 Klein 坐标做欧式投影初值；（ii）沿弧长单调的测地线搜索精化；保证 1-Lipschitz（第 28 节）。
- 碰撞与可视："直线=测地"使得射线投射、可见性、多边形布尔运算在 Klein 坐标可重用欧式算法；仅长度与角度需 CK 替换。
- 路径规划：将约束集合表述为测地半空间交，A* 或 Dijkstra 在图上运行，边权为 CK 距离（第 30、35 节的稳定实现）。
- 学习/优化：在球内优化时引入快度步长（$\Delta r$）以避免半径方向的数值畸变；或转入 Poincaré 模型进行保角梯度，再映回。

## 48. 参考扩展与阅读指引

- Thurston, W. P. (1997). Three-Dimensional Geometry and Topology, Vol. 1.
- Benedetti, R., Petronio, C. (1992). Lectures on Hyperbolic Geometry.
- Ratcliffe, J. (2006). Foundations of Hyperbolic Manifolds. 2nd ed. Springer.
- Papadopoulos, A. (2014). Handbook of Hilbert Geometry. EMS.
- Benoist, Y.（Hilbert 几何/凸可除集系列论文）。
- Stillwell, J.（历史与来源）。

（导航）快速应用可优先参阅：度量闭式（第 8、33 节）、角度（第 11 节）、模型互换（第 14、20 节）、体积与三角（第 18–19、25、45 节）、数值与算法（第 30、35、47 节）。

## 49. 附录 A：第 8 节二维闭式公式的细化推导

设 $p,q\in\mathbb{D}^2$，弦参数 $\gamma(t)=p+t(q-p)$。令 $u=q-p$，解 $\lVert p+t u\rVert^2=1$ 得二次方程
$$
 \lVert u\rVert^2 t^2+2\langle p,u\rangle t+\lVert p\rVert^2-1=0.
 $$
记判别式 $\Delta=(\langle p,u\rangle)^2-\lVert u\rVert^2(\lVert p\rVert^2-1)$，则根为
$$
 t_\pm=\frac{-\langle p,u\rangle\pm\sqrt{\Delta}}{\lVert u\rVert^2}.
 $$
由交比 $[t_+,t_-;0,1]=\dfrac{t_+}{t_-}\cdot\dfrac{t_--1}{t_+-1}$ 计算并整理，可化简为
$$
 \cosh d(p,q)=\frac{1-\langle p,q\rangle}{\sqrt{(1-\lVert p\rVert^2)(1-\lVert q\rVert^2)}}.
 $$
（要点）使用恒等式 $\langle p,u\rangle=\langle p,q\rangle-\lVert p\rVert^2$ 与 $\lVert u\rVert^2=\lVert p\rVert^2+\lVert q\rVert^2-2\langle p,q\rangle$ 代数消元。

## 50. 附录 B：第 15 节度量张量与体积行列式

将嵌入 $\iota: x\mapsto X=(1,x)/\sqrt{1-\lVert x\rVert^2}$ 代入 $\langle \mathrm{d}X,\mathrm{d}X\rangle_L$：
$$
 \mathrm{d}X=\frac{1}{\sqrt{1-\lVert x\rVert^2}}(0,\mathrm{d}x)+\frac{\langle x,\mathrm{d}x\rangle}{(1-\lVert x\rVert^2)^{3/2}}(1,x),
 $$
计算得
$$
 g_x=\frac{\mathrm{d}x\cdot\mathrm{d}x}{1-\lVert x\rVert^2}+\frac{\langle x,\mathrm{d}x\rangle^2}{(1-\lVert x\rVert^2)^2}.
 $$
行列式可由矩阵行列式引理得
$$
 \det\Big(\frac{1}{1-\lVert x\rVert^2}I+\frac{1}{(1-\lVert x\rVert^2)^2}xx^\top\Big)=(1-\lVert x\rVert^2)^{-(n+1)}.
 $$
从而体积元如第 18 节所述。

## 51. 附录 C：Hilbert 范数到 CK 黎曼度量（二次边界情形）

在严格凸域 $\Omega$ 的 Hilbert 几何中，$\lVert v\rVert_{H,p}=\tfrac12(\alpha^{-1}+\beta^{-1})\lVert v\rVert$。当 $\partial\Omega$ 为二次曲面且对称（单位球）时，$\alpha,\beta$ 可一阶展开为
$$
 \alpha=\frac{1-\lVert p\rVert^2}{\langle v,\nu\rangle+\langle p,v\rangle},\quad \beta=\frac{1-\lVert p\rVert^2}{\langle v,\nu\rangle-\langle p,v\rangle},
 $$
经代入得
$$
 \lVert v\rVert_{H,p}^2= g_p(v,v),
 $$
与 Klein 黎曼度量一致。一般椭球边界可由仿射归一化（第 36 节）归约到单位球情形。

## 52. 附录 D：实用伪代码（距离/角度/反射/投影）

- 距离（单位球，Klein 模型）

```text
function CKDistance(p, q):
    s = dot(p, q)
    a = 1 - norm2(p)
    b = 1 - norm2(q)
    z = (1 - s) / sqrt(max(a,eps) * max(b,eps))
    z = max(z, 1)
    return acosh_stable(z)
```

- 角度（对偶法，二维示意）

```text
function CKAngle(p, dir1, dir2):
    # 构造两条过 p 的直线的对偶点 L1, L2
    L1, L2 = dualize_lines(p, dir1, dir2)  # 依 A^{-1}
    U, V = intersect_line_with_dual_absolute(L1, L2)
    return 0.5 * abs(log(cross_ratio(U, V, L1, L2)))
```

- 反射（双曲面/Lorentz 形式）

```text
function ReflectLorentz(Z, N):
    return Z - 2 * inner_L(Z, N) / inner_L(N, N) * N
```

- 最近点投影（到测地凸集 C 的数值方案）

```text
function ProjectToConvexKlein(x, C):
    y = EuclideanProject(x, C)
    for k in 1..K:
        dmin = +inf; ybest = y
        for each support halfspace H of C:
            yH = geodesic_line_search(y, H)
            if CKDistance(yH, y) < dmin: ybest = yH; dmin = ...
        y = ybest
    return y
```

## 53. 附录 E：部分练习答案提要

- 第 13 节（1）：见第 49 节完整推导；（3）：按第 9 节欧氏极限展开，极限群缩并见 Inönü–Wigner。
- 第 31 节（1）：Jacobi 方程通解 $J=a\sinh t+b\cosh t$；体积元素指数增长由球面积 $\sinh^{n-1} r$ 得。
- 第 30 节矩阵反射：在双曲面模型写出 $R$ 后，经第 24 节中心投影与第 14 节互换，即得 Klein 中的分式线性表示。

## 54. 结语

在 Erlangen 纲领的视角下，"射影 + 绝对 + 交比"统一了欧氏与非欧几何：绝对的类型（实/退化/虚）对应三大几何；CK 距离与对偶角度提供了统一的度量—角度结构；群论（$\mathrm{Proj}(\mathcal{Q})$）刻画了等距与对称。本文从定义、模型互换、度量张量、边界与流、到数值实现与应用，给出了一条可复用的形式化路径，便于在理论与实践中继续拓展（Hilbert 几何、离散群、物理建模等）。

## 55. 常见误区与澄清（Pitfalls）

- "Klein 模型非保角 ⇒ 三角公式失效"：三角恒等式与曲率性质与模型无关；仅角度计算需用对偶绝对或先转 Poincaré。
- "测地为直线 ⇒ 连接平凡"：连接与曲率由度量决定；虽测地轨迹是欧直线，但参数与变分理论均非平凡（见第 27 节）。
- "Hilbert 度量总是黎曼的"：仅二次边界情形黎曼；一般严格凸域是 Finsler 型（第 12 节）。
- "绝对退化就无度量"：欧氏为双曲/椭圆的退化极限，合理极限与群缩并后可恢复标准欧氏结构（第 9 节）。

## 56. FAQ（简要）

- 如何在一般椭球绝对下计算距离？
  - 用第 36 节仿射归一化到单位球，套用第 8 节闭式再映回。
- Klein 与 Poincaré 如何互换？
  - 用第 14 节的显式双向公式；二维时再与第 20 节 Cayley 变换连接到半平面。
- 角度如何稳定计算？
  - 建议走对偶绝对交比（第 11 节）或映射至 Poincaré 后用黎曼角；避免直接用欧氏角。
- 离散群基本域如何构造？
  - 用 Dirichlet 域（第 26 节），在 Klein 中为测地半空间的有限交。

## 57. 符号速查（Quick Reference）

- $\mathcal{Q}$：绝对（二次曲线/曲面）；$A$：其对称矩阵；$\mathcal{Q}^*$ 与 $A^{-1}$：对偶绝对。
- $\mathrm{Proj}(\mathcal{Q})$：保持绝对的射影群；双曲情形为 $\mathrm{PO}(1,n)$ 的射影像。
- CK 距离（单位球）：$\displaystyle \cosh d(p,q)=\frac{1-\langle p,q\rangle}{\sqrt{(1-\lVert p\rVert^2)(1-\lVert q\rVert^2)}}$。
- 模型互换：Klein→Poincaré $\displaystyle u=\frac{k}{1+\sqrt{1-\lVert k\rVert^2}}$；Poincaré→Klein $\displaystyle k=\frac{2u}{1+\lVert u\rVert^2}$。
- 体积元（Klein）：$\mathrm{d}\mathrm{vol}=(1-\lVert x\rVert^2)^{-(n+1)/2}\,\mathrm{d}x$。

## 58. 记号与版式约定

- 内积、范数默认为欧氏；Lorentz 内积以 $\langle\cdot,\cdot\rangle_L$ 表示。
- 齐次坐标列向量约定；$[X]$ 表示射影类；必要时区分仿射点 $x$ 与提升 $X=(x,1)$。
- 绝对、对偶绝对及其矩阵对使用同一字体并在首次出现处声明。

## 59. 主题索引（关键词）

Cayley–Klein 距离；交比；绝对；对偶绝对；Klein/Beltrami；Poincaré；Hilbert 度量；Iwasawa/KAN；Busemann；horosphere；CAT(-1)；Gromov 超曲率；Dirichlet 域；Lorentz 反射；欧氏极限；Inönü–Wigner 缩并；极性；三角恒等式。

## 60. 致谢与版本记录

- 致谢：感谢相关经典参考与现代综述为统一叙述提供线索（见参考文献与扩展）。
- 版本 1.0：完成 0–60 节初稿，含定义、模型互换、度量张量、边界与流、离散群与算法建议、附录与索引。

## 61. 刚性：Mostow 与熵刚性（Besson–Courtois–Gallot）

- Mostow 刚性（维数 ≥ 3）：有限体积双曲流形由其基本群唯一确定；任意标记等距同构由群同构诱导。Klein/双曲面/球/半平面模型等价，不影响刚性结论。
- 熵刚性：对闭流形 $M$，若度量的体积熵与双曲度量相同且体积相同，则等距（BCG 定理）。在 CK 视角下，熵（测地流拓扑熵）与绝对/群作用紧密关联。
- 二维例外：$n=2$ 不满足 Mostow 刚性（存在 Teichmüller 模空间）。

## 62. Hilbert 几何的 Gromov 超曲率刻画（Benoist）

- 设 $\Omega\subset\mathbf{RP}^n$ 为严格凸开集，赋 Hilbert 度量 $d_{H,\Omega}$。则：
  - $d_{H,\Omega}$ 为 Gromov 超曲率 当且仅当 $\partial\Omega$ 不含线段（严格凸）且 $\partial\Omega$ 至少 $C^1$；
  - 若 $\partial\Omega$ 为二次曲面，则等距于双曲几何（CK 情形）。
- 可除集与离散群：若存在离散群 $\Gamma\subset\mathrm{Aut}(\Omega)$ 使 $\Omega/\Gamma$ 紧，则 $\Omega$ 为严格凸，且几何/动力学良好（阴影引理与 Patterson–Sullivan 度量适用）。

## 63. Patterson–Sullivan 度、临界指数与影子引理

- 临界指数：$\delta_\Gamma=\limsup_{R\to\infty}\tfrac1R\log\#\{\gamma\in\Gamma:\ d(o,\gamma o)\le R\}$，等于测地流拓扑熵（有限体积）。双曲空间中 $\delta_\Gamma=n-1$。
- Patterson–Sullivan 度量族：在边界 $\partial_\infty$ 上构造 $\{\mu_o\}$，满足 $\mathrm{d}\mu_x(\xi)=e^{-\delta_\Gamma b_\xi(x)}\,\mathrm{d}\mu_o(\xi)$（$b_\xi$ 为 Busemann）。
- 影子引理：对 $\gamma\in\Gamma$ 与球影子 $\mathcal{O}_o(\gamma o,R)$，$\mu_o(\mathcal{O}_o(\gamma o,R))\asymp e^{-\delta_\Gamma d(o,\gamma o)}$。Klein 模型中用直线/弦表述影子几何等价。

## 64. Poisson 核、调和测度与 Martin 边界

- Poisson 核：在双曲空间 $\mathbb{H}^n$，对 $x\in\mathbb{H}^n,\ \xi\in\partial_\infty$，$P(x,\xi)=e^{-(n-1)b_\xi(x)}$（尺度等价）。
- 边界积分表示：调和函数 $u(x)=\int_{\partial_\infty} P(x,\xi)\,\mathrm{d}\nu(\xi)$。Klein 坐标下 $b_\xi(x)$ 可经第 14、20 节模型互换稳定计算。
- Martin 边界：负曲率完备情形下，Martin 边界与可视边界同胚（标准双曲几何成立）。

## 65. Klein 模型下的拉普拉斯—贝尔特拉米算子（提纲）

记 $g_{ij}(x)=\dfrac{\delta_{ij}}{1-\lVert x\rVert^2}+\dfrac{x_i x_j}{(1-\lVert x\rVert^2)^2}$，$g^{ij}$ 为逆矩阵，$\sqrt{|g|}=(1-\lVert x\rVert^2)^{-(n+1)/2}$。则
$$
 \Delta_K f=\frac{1}{\sqrt{|g|}}\,\partial_i\big(\sqrt{|g|}\,g^{ij}\,\partial_j f\big).
 $$
可用下述等价配方计算：

- 先映到 Poincaré 球用已知公式 $\Delta_P$ 再拉回；
- 或直接用 $g^{ij}=(1-\lVert x\rVert^2)\big(\delta_{ij}-x_i x_j\big)$ 的简化形式进行实现（与度量对偶矩阵的显式计算一致）。

## 66. 长度谱、素测地与 Zeta

- 标记长度谱：$\mathcal{L}_M(\gamma)=\ell(\gamma)$（按共轭类）。在曲率 $-1$ 情形，标记长度谱刚性在曲面上成立（Croke–Otal）。
- 素测地定理：闭测地条数满足 $\#\{\text{闭测地 }\ell\le L\}\sim \dfrac{e^{(n-1)L}}{(n-1)L}$（$\mathbb{H}^n/\Gamma$）。
- Zeta：二维下 Selberg Zeta 与长度谱、拉普拉斯谱、测地流谱互相关联。

## 67. 厚—薄分解与 Margulis 引理

- Margulis 常数 $\varepsilon_n$：若 $\Gamma$ 中生成局部区域的元素平移长度 $<\varepsilon_n$，则该子群近似可解；据此分解流形为厚区与细颈（薄区为管状或 cusp）。
- Klein 可视化：细颈对应边界上近聚的理想点对，Klein 坐标中为靠近绝对的窄通道；基本域截面体现厚薄结构。

## 68. 计算与可视化补充

- 射线裁剪：在 Klein 中使用欧式半空间裁剪（Sutherland–Hodgman）即可；但边权、长度与角度用 CK 配方替换。
- 近边界稳定：当 $\lVert x\rVert\to 1^-$，建议使用 Poincaré 模型做数值（条件更好），再映回；或采用"快度"半径坐标 $r=\operatorname{artanh}\lVert x\rVert$。
- 网格生成：测地三角剖分可在 Klein 中做直线剖分，再统一弧长参数化；角度用第 11 节。

## 69. 进一步阅读与开放问题

- 熵刚性与体积最小性：BCG 定理的更广义版本在凸射影几何/Anosov 表示中的推广。
- Benoist 计划：Hilbert 几何的度量性质（曲率下界、谱、等周）与边界正则性的定量关系。
- Patterson–Sullivan 度与统计性质：混合性、等温态、Bowen–Margulis 度量在 CK/凸射影设置下的构造与唯一性。
- 长度谱刚性在凸射影曲面中的推广与限制。

## 70. 小结与后续

本文现已覆盖从交比定义、绝对与保持群、三大几何统一、模型互换与度量张量、边界/流/度量熵、离散群与基本域、到数值/算法与应用的完整链条。后续可针对具体研究或工程应用，围绕第 33、35、36、47、52 节的"可实现"配方进行模块化实现与测试，并扩展到一般凸射影几何与 Hilbert Finsler 几何的更广场景。

## 71. Anosov 表示与凸射影结构（概览）

- Anosov 表示：将 $\pi_1(S)$（曲面）或更一般的双曲群 $\Gamma$ 表示到 $\mathrm{PGL}(n+1,\mathbb{R})$，满足 Finsler/旗形收缩性质，诱导良好的边界嵌入 $\partial_\infty\Gamma\to$ 旗流形。
- 凸射影结构：若 $\rho(\Gamma)$ 作用协变于某严格凸域 $\Omega\subset\mathbf{RP}^n$ 且恰当不连续，得商 $\Omega/\rho(\Gamma)$ 的（Hilbert）凸射影几何。二次边界即退化为 CK/双曲几何。
- Labourie—Guichard–Wienhard：Hitchin 组是 Anosov，带来广义 Teichmüller 分量；Benoist 则刻画了严格凸可除集与群的代数性质。

## 72. 热力学形式主义与测地流（Bowen–Margulis 度）

- 压强与等温态：对势函数 $\phi$ 定义压强 $P(\phi)$ 与 Gibbs 态；取 $\phi=0$ 得测地流的拓扑熵 $h_{\text{top}}$。
- Bowen–Margulis 度：在负曲率（含双曲）下，存在唯一的测地流最大熵不变测度；与 Patterson–Sullivan 度通过 Hopf 公式相关（第 63 节）。
- 混合性与指数衰减：对共紧作用，测地流混合且常具谱隙；在二维可与 Selberg 谱联系（第 66 节）。

## 73. 谱理论概要：拉普拉斯谱、Selberg 迹与散射

- 底谱与谱隙：$\mathbb{H}^n/\Gamma$ 上 $\lambda_0\ge (n-1)^2/4$，等号在共紧时取不到；谱隙与混合速率、扩散性质相关。
- Selberg 迹公式（$n=2$）：将拉普拉斯谱与闭测地长度谱联系；Zeta 函数零点与特征值相联。
- 散射理论：非紧有限体积情形，连续谱与 Eisenstein 级数；Poisson 核与边界值在第 64 节给出。

## 74. 等周、Sobolev 与 Poincaré 不等式

- 双曲空间中等周不等式改写为以 $\sinh$ 控制的面积—体积关系（第 25 节）。
- Poincaré—Sobolev：常数优于欧氏情形（负曲率促使"更强"的扩散/混合）。
- Cheeger 不等式：$\lambda_1\ge h^2/4$；双曲情形 $h$ 与 $n-1$ 相关，给出谱下界。

## 75. Hilbert Finsler 几何的曲率与平坦性

- 旗曲率与 Chern–Rund 连接：一般严格凸域上 Hilbert 度量为可逆 Finsler，可讨论旗曲率（flag curvature）。二次边界情形旗曲率常数为 $-1$，且为射影平坦（projectively flat）。
- 形变与边界正则：Benoist 与后续工作给出边界正则性（如 $C^{1,\alpha}$）与曲率性质、谱性质间的定量关系。

## 76. 计算几何与 GPU 实现注记（Klein 坐标）

- 半空间交与凸多面体：Klein 中测地半空间=欧式半空间，可直接用 H-表述与现成凸包/半空间交库；距离/角度在后处理阶段评估。
- 裁剪/栅格化：采用标准多边形裁剪与光栅化，顶点坐标在 Klein 中处理；避免近边界数值不稳定可转 Poincaré 再回。
- GPU：将 CK 距离的闭式、`acosh` 稳定实现与快度半径 $r$ 预计算进常量/纹理，减少分支；双精度或混合精度在边界附近启用。

## 77. 机器学习中的超曲率嵌入（Klein vs Poincaré）

- 损失与负采样：层级/树型数据常用双曲距离损失 $\mathcal{L}=\sum w_{ij}\,d(x_i,x_j)$ 与 margin 对比损失；Klein 下直线测地便于约束与可视化。
- 优化：Riemannian-SGD 可在 Poincaré 上执行，再映回 Klein；或在 Klein 以"快度步长"近似指数/回缩。投影保持 $\lVert x\rVert<1$（边界留安全裕度）。
- 正则化：对中心化与方差控制可在快度坐标 $r$ 上做 L2/L1 正则，避免过度靠边界聚集。

## 78. 应用示例（导航、系统与数据科学）

- 网络导航：在 Klein 中最短路近似欧线+权重修正；对层次路由具更好"拉直"效果。
- 系统布局：将进程/容器的亲和度图嵌入双曲球，社区分裂更清晰；可用第 30、35 节的稳定实现。
- 进化树/NLP 层级：Klein 渲染直线边利于可视与交互；训练阶段仍可在 Poincaré，推理与展示转 Klein。

## 79. 扩展练习（研究级）

1) 设 $\Gamma$ 为共紧 Fuchsian 群，证明其 Bowen–Margulis 测度唯一且测地流混合；并以 Selberg 迹公式勾连谱与长度谱。
2) 证明对严格凸域 $\Omega$，若 $\partial\Omega\in C^{1,\alpha}$ 且无线段，则 $(\Omega,d_H)$ 为 Gromov 超曲率；找出 $C^1$ 不足时的反例轮廓。
3) 在椭球绝对下实现 GPU 版最近点投影与路径规划，分析近边界精度与吞吐的权衡。
4) 设计一个双曲嵌入训练流程：Poincaré 上 Riemannian-SGD + 动态快度截断 + Klein 可视化，比较不同负采样策略的影响。

## 80. 版本 1.1 变更

- 新增 71–79 节：Anosov/凸射影、热力学/熵、谱与迹、等周/Sobolev、Hilbert Finsler 曲率、计算几何与 GPU、超曲率嵌入应用与练习。
- 细化：补充若干稳定实现与可视化建议（第 35、68、76–78 节）。

## 81. 粗几何与拟等距、边界拟 Möbius

- 拟等距不变量：$\mathbb{H}^n$ 与 Gromov 超曲率群的 Cayley 图拟等距，边界（可视度量拟等价类）在拟等距下一致到拟 Möbius（quasi-Möbius）映射。
- 交比畸变：拟 Möbius 映射满足交比的双边畸变控制；在 CK 视角，边界交比与内部 Busemann 结构相连（第 21、63 节）。
- 结论：粗几何级别的等价，反映到边界的拟共形/拟 Möbius 类保持。

## 82. 边界的共形维数与 Ahlfors 正则

- 共形维数 $\mathrm{ConfDim}(\partial_\infty\Gamma)$：在所有准同胚到 Ahlfors 正则度量下的 Hausdorff 维最小值；Kleinian 群边界常与极限集维数相关。
- 应用：共形维数与谱、熵、Poincaré 不等式常数存在联系；在凸射影环境（Hilbert）可望建立类似框架。

## 83. Cannon–Thurston 映射与极限集

- 定义：群或子群的 Cayley 图边界到环境空间（如 $\mathbb{H}^3$）的极限集之间的连续满射；在三维双曲 3-流形/纤维化情况下存在（Cannon–Thurston）。
- 几何意义：将内部测地"投影"为边界曲线的填充；在 CK 视角边界=绝对，可通过可视度量与投影理解。

## 84. 随机游走、熵—漂移与调和测度

- 随机游走 $(G,\mu)$ 在 $\mathbb{H}^n/\Gamma$ 上的投影收敛到边界，极限测度为调和测度 $\nu$。
- 关系式：熵—漂移—维数（Guivarc'h）：$h \le \ell\,v$，其中 $h$ 为熵、$\ell$ 为漂移速率、$v$ 为体积增长率（$n-1$）；等号刻画几何与测度的对齐。

## 85. 等周轮廓、Dehn 函数与群几何

- Dehn 函数：双曲群的填充函数线性界，等价于薄三角性质；几何上与负曲率下的等周性质相呼应（第 29、74 节）。
- 计算含义：在超曲率嵌入的图优化中，线性填充性质支撑快速近似与良好局部化划分。

## 86. 测地电流与交叉形式（二维）

- Bonahon 测地电流空间 $\mathcal{C}(S)$ 与交叉形式 $i(\cdot,\cdot)$；长度函数 $L_g$ 线性作用于电流。
- 关联：长度谱延拓为对测地电流的线性泛函；与第 66 节长度谱刚性、Selberg 迹互有联系。

## 87. 超曲率嵌入的离散优化与树近似

- 树近似：双曲度量对树度量具有更低扭曲的嵌入；用于层次结构、路由、索引。
- 离散优化：Steiner 树/设施选址可在 Klein 模型下进行启发式"拉直"与快度正则，提升收敛与可解释性。

## 88. 数值 PDE：Poisson/Helmholtz 在模型间的变换

- 策略：将域映至 Poincaré 模型，使用标准有限元/谱方法解 $\Delta_P u=f$，再按第 14 节映回 Klein；或直接用第 65 节的 $\Delta_K$ 实作。
- 边界条件：在理想边界上使用加权条件（Poisson 核），或截断到 $\lVert x\rVert=1-\epsilon$ 并施 Robin/吸收条件。

## 89. 工具生态与参考实现

- 几何库：CGAL（凸/半空间）、libigl（网格）、FEniCS（PDE）、Eigen（线代）；数值稳定参第 35 节。
- 双曲/射影：一些研究实现提供 Poincaré/Klein 转换、CK 距离、测地渲染与群作用的可视化模块；GPU 参第 76 节。

## 90. 版本 1.2 变更

- 新增 81–89 节：粗几何与边界拟 Möbius、共形维数、Cannon–Thurston、随机游走与熵—漂移、Dehn/等周、测地电流、离散优化、数值 PDE、工具生态。
- 统一若干术语与符号，微调格式与跨节引用。

## 91. 例题详解（二维单位圆绝对）

- 已知 $p=(0.3,0.1),\ q=(-0.2,0.4)$，求 $d(p,q)$：
  - $s=\langle p,q\rangle=-0.02$，$1-\lVert p\rVert^2=1-0.1=0.9$，$1-\lVert q\rVert^2=1-0.2=0.8$；
  - $z=\dfrac{1-s}{\sqrt{0.9\cdot 0.8}}\approx \dfrac{1.02}{\sqrt{0.72}}\approx 1.199$；
  - $d=\operatorname{arcosh}(z)\approx \log\big(z+\sqrt{z^2-1}\big)\approx 0.622$。
- 过 $p$ 的两条方向 $u=(1,0),\ v=(0,1)$ 的夹角：按第 11 节二维公式代入得 $\cos\angle(u,v)=\dfrac{-\langle p,u\rangle\,\langle p,v\rangle}{\sqrt{(1-\langle p,u\rangle^2)(1-\langle p,v\rangle^2)}}$，数值约 $0.030$，角约 $88.3^\circ$。

## 92. 实作模板：矩阵与 API 接口（示意）

- 归一化接口：

```text
struct CKNormalizer {
    Matrix A;      // quadric
    Matrix T, Ti;  // normalization and inverse
    void fit(const Quadric& Q); // compute T: T^T A T -> diag(I,-1)
    Vec  toUnitBall(const Vec& x) const;  // x -> k
    Vec  fromUnitBall(const Vec& k) const; // k -> x
};
```

- 距离/角度：

```text
double ck_distance_unit(const Vec& p, const Vec& q);
double ck_angle_dual2D(const Vec& p, const Vec& dir1, const Vec& dir2, const Matrix& Ainv);
```

- 反射/群作用：

```text
Vec lorentz_reflect(const Vec& Z, const Vec& N);
Mat projective_isometry_from_reflections(const std::vector<Hyperplane>& Hs);
```

## 93. 角度公式推导补充（二维对偶法）

- 设单位圆绝对，过点 $p$ 的直线 $\ell$ 的极点为 $L=(a,b)$，满足 $ax+by=1$ 在 $p$ 上等式成立且与圆相切；两条直线对应 $L_1,L_2$，其连线与对偶绝对交 $U,V$。
- 以 $[U,V;L_1,L_2]$ 计算角度交比，代数化简得第 11 节的余弦公式；若转至 Poincaré 再验算，可得相同角度。

## 94. 模型比较表（要点）

| 模型 | 测地 | 角度 | 距离闭式 | 数值条件 |
|---|---|---|---|---|
| Klein | 直线弦 | 非保角（用对偶/互换） | 第 8/33 节 | 近边界较差（用快度/互换） |
| Poincaré 球 | 圆/直径，保角 | 保角 | 经典公式 | 条件好 |
| 上半平面 | 半圆/竖线，保角 | 保角 | 经典公式 | 条件好 |
| 双曲面 | 线性群作用 | 保角 | $-\langle X,Y\rangle_L$ | 线性友好 |

## 95. 误差来源与测试用例

- 浮点误差：近边界 $\lVert x\rVert\to 1^-$ 时 `acosh` 与开方易病态；使用钳制与系列展开（第 35 节）。
- 交点求解：二次方程近重根使用 Kahan 重排；对偶空间运算保持对称性。
- 回归测试：
  - 单位球随机点对，Klein 与 Poincaré 结果一致（误差 < 1e-9）。
  - 反射/等距长度保持；闭合环路零净位移。

## 96. 教学项目建议

- 项目 A：实现单位球 CK 距离/角度与 Klein↔Poincaré 互换，完成 13、31 节练习。
- 项目 B：离散群反射生成（第 23、26 节），绘制 Dirichlet 域与极限集。
- 项目 C：双曲嵌入（第 77 节），小型层级数据集可视与检索。

## 97. 数据与资源（线索）

- 经典数据：合成树/层次网、小型 Fuchsian 群生成器、规则多边形基本域。
- 开源生态：线代/几何/PDE 库（见第 89 节）；学术实现常包含 Poincaré/Klein 转换与可视模块。

## 98. 术语扩展（补充）

- **loxodromic**：双曲型等距（带可能旋转）。
- **horocycle/horosphere**：测地视界的二维/高维情形。
- **visual metric**：可视度量，基于 Busemann—Gromov 乘积。
- **flag curvature**：Finsler 旗曲率。

## 99. 勘误与反馈

- 若发现符号/公式/排版问题，建议按节编号与式号反馈；勘误将并入后续版本记录。

## 100. 版本 1.3 变更

- 新增 91–99 节：例题、API 模板、角度推导、模型比较、测试与项目、资源与术语、勘误。
- 调整：统一若干术语与表格版式；微调跨节引用。

## 101. 注释版参考文献与阅读路径（精选）

- Cayley (1859). Quantics.——交比与二次型的起点。
- Klein (1872). Erlangen 纲领。——"几何=不变量+群"。
- Hilbert (1895–1925). Grundlagen/直线最短。——Hilbert 度量与几何公理化。
- Busemann (1955). Geometry of Geodesics.——测地线与度量几何基础。
- Berger (1987). Geometry I/II.——黎曼几何与模型综述。
- Ratcliffe (2006). Foundations of Hyperbolic Manifolds.——双曲几何"百科"。
- Bridson–Haefliger (1999). Metric Spaces of Non-Positive Curvature.——CAT(κ)。
- Papadopoulos (2014). Handbook of Hilbert Geometry.——Hilbert 几何现代进展。
- Benoist（2003–2010）. Convex divisible sets 系列。——凸射影与 Hilbert 几何核心。
- Labourie/Guichard–Wienhard（2008–）. Anosov 表示与 Hitchin 组。——高阶 Teichmüller。
- Besson–Courtois–Gallot (1995). 熵刚性。——负曲率刚性范式。
- de la Harpe (1990). GGT。——群与几何联系概览。

建议路径：第 8/14/15（核心公式）→ 第 24/25（几何结构）→ 第 30/35（实现）→ 第 62/63/72（动力与测度）→ 第 73/74/75（谱与不等式）。

## 102. 定理/命题/引理索引（按节标）

- 定义/性质：2.1（CK 距离），4.1（对偶角度），8（闭式）。
- 结构：10（齐性空间分解），14（模型互换），15（度量张量），18（体积元），19（角缺）。
- 群与反射：23（反射生成），34（等距分类），37（KAN 分解）。
- 边界与测度：21（可视边界），22（Busemann/horosphere），63（Patterson–Sullivan）。
- 刚性/谱：61（Mostow/BCG），66（长度谱），73（迹公式要点）。

## 103. 符号全表（补充）

| 符号 | 含义 |
|---|---|
| \(\mathcal{Q},A\) | 绝对与其矩阵（第 17,33 节） |
| \(\mathcal{Q}^*,A^{-1}\) | 对偶绝对与矩阵 |
| \([A,B;X,Y]\) | 交比（第 1.1 节） |
| \(d_{\mathcal{Q}}\) | CK 距离（第 2 节） |
| \(b_\xi\) | Busemann 函数（第 22 节） |
| \(K,A,N\) | Iwasawa 分解因子（第 37 节） |
| \(g_x\) | Klein 度量张量（第 15 节） |
| \(\Delta_K\) | Klein 拉普拉斯（第 65 节） |

## 104. 公式与恒等式速查

- 距离（单位球）：\(\cosh d(p,q)=\dfrac{1-\langle p,q\rangle}{\sqrt{(1-\lVert p\rVert^2)(1-\lVert q\rVert^2)}}\)。
- Klein↔Poincaré：\(u=\dfrac{k}{1+\sqrt{1-\lVert k\rVert^2}},\ k=\dfrac{2u}{1+\lVert u\rVert^2}\)。
- 体积元：\(\mathrm{d}\mathrm{vol}_K=(1-\lVert x\rVert^2)^{-(n+1)/2}\,\mathrm{d}x\)。
- 双曲三角余弦定理：\(\cosh c=\cosh a\cosh b-\sinh a\sinh b\cos\gamma\)。
- Poisson 核：\(P(x,\xi)=e^{-(n-1)b_\xi(x)}\)。

## 105. 证明补编 I：归一化与一般二次型闭式

目标：第 33 节闭式。取可逆 \(T\) 使 \(T^\top A T=\mathrm{diag}(I_n,-1)\)。齐次提升 \(X=(x,1)\), \(\tilde X=T^{-1}X\)。则
\(\langle X,Y\rangle_A = \langle \tilde X,\tilde Y\rangle_{L}\)，其中右侧为标准 Lorentz 配对。由双曲面模型距离公式与中心投影（第 24 节）即得闭式，并与单位球式（第 8 节）一致。

## 106. 证明补编 II：对偶角度与 KAN 流提纲

- 角度：对偶空间上四点交比定义角度，利用 \(g^\top A g=\lambda A\) 保持极性与交比不变；再与 Poincaré 保角模型等距（第 14 节）校验一致性。
- 流：在 \(\mathrm{PO}(1,n)\) 的 Lie 代数层面给出 Cartan 分解与 Iwasawa 分解；测地流由 \(A\) 的右乘轨道构成，horosphere 流由 \(N\) 作用构成，参见标准半单群理论（Helgason）。

## 107. 实验与复现清单（建议）

- E1：随机点对距离一致性（Klein vs Poincaré）。
- E2：反射等距群生成的长度保持与闭环误差为零。
- E3：Dirichlet 域构造与可视化（第 26 节）。
- E4：Bowen–Margulis 混合性数值迹象（相关自相关衰减）。

## 108. 实现诊断清单（常见问题）

- D1：距边界溢出（\(\lVert x\rVert\to 1\)）→ 使用快度半径/模型互换；
- D2：`acosh` NaN → 先钳制 \(z\ge 1\) 并用稳定公式；
- D3：交点近重根→ Kahan 重排或使用伴随矩阵法；
- D4：角度异常→ 走对偶角度或转 Poincaré 保角再算。

## 109. 跨模型基准 API（语言无关示意）

- `Normalize(Q) -> (T, A_std)`: 将一般绝对归一到单位球；
- `ToUnitBall(T, x) -> k` / `FromUnitBall(T, k) -> x`；
- `Distance(k1, k2) -> d`（单位球闭式）；
- `AngleDual2D(p, dir1, dir2, Ainv) -> theta`；
- `KleinToPoincare(k) -> u` / `PoincareToKlein(u) -> k`；
- `ReflectLorentz(Z, N) -> Z'`；
- `DirichletDomain(Gamma, o) -> Polytope`。

## 110. 版本 1.4 变更与后续

- 新增 101–109 节：注释版参考、索引与速查、证明补编、实验与诊断、跨模型 API。
- 路线：完善附图与数值基准，补充更完整的练习答案与可视化素材；预备 1.5 版加入图表与交互链接。

## 111. 图示与可视化指南（要点）

- Klein：
  - 画单位球/圆与弦测地；
  - 角度以对偶极线/极点示意；
  - 反射为分式线性映射，配对超平面镜像。
- Poincaré：
  - 画与边界正交的圆/直径；
  - 角度即欧氏角；
  - 与 Klein 的同点连线对照（第 14 节）。
- 半平面：
  - 半圆/竖线；
  - Cayley 变换前后关键点标注（第 20 节）。

## 112. 交互式笔记本任务（Jupyter 指南）

- 任务 A：单位球 CK 距离热力图（网格采样+稳定 `acosh`）。
- 任务 B：Klein↔Poincaré 点云互换一致性测试（误差统计）。
- 任务 C：反射生成的 Dirichlet 域可视化（二维）。
- 任务 D：Bowen–Margulis 自相关曲线数值估计（二维曲面）。

## 113. 题库（选/计/证，摘选）

- 选择：单位球闭式中，当 \(\lVert p\rVert,\lVert q\rVert\to 0\) 时，下列极限正确的是？（A）欧氏距离；（B）球面距离；…（解：A）
- 计算：给出一般椭球绝对下两点距离的数值流程，并估算算法的条件数。
- 证明：第 46 节三路推导中任选一路补齐细节并相互验证。

## 114. 常见错误对照（扩展）

- 将欧氏角直接当作 Klein 角使用 → 用对偶角或转 Poincaré。
- 未归一化一般二次型就直接套单位球闭式 → 先做仿射归一化（第 33、36 节）。
- 近边界距离溢出 → 钳制 + 系列展开 + 快度半径。

## 115. 参考实现结构建议（仓库草案）

```text
ck-geom/
  core/
    quadric.h/.cc        # A, A^{-1}, 归一化 T
    distance.h/.cc       # CK 距离（单位球 + 一般二次型）
    angle_dual.h/.cc     # 对偶角度（2D/ND 桥接）
    models.h/.cc         # Klein↔Poincaré↔半平面
  alg/
    reflect.h/.cc        # 反射与群生成
    dirichlet.h/.cc      # 基本域构造
  viz/
    draw_klein.*         # Klein 可视化
    draw_poincare.*      # Poincaré 可视化
  notebooks/
    A_distance_heatmap.ipynb
    B_model_consistency.ipynb
```

## 116. 实验记录模板（表格）

| 实验 | 数据 | 设定 | 指标 | 结果 | 备注 |
|---|---|---|---|---|---|
| A | 随机点云 | Klein↔Poincaré | RMSE | 1.2e-9 | 双精度 |
| B | Fuchsian | Dirichlet 域 | 面积误差 | <1e-10 | 反射数=12 |

## 117. 术语中英扩展补充

- **polar/ polarity**：极线/极点 对偶；
- **Iwasawa decomposition**：Iwasawa 分解（KAN）；
- **visual boundary**：可视边界；
- **Patterson–Sullivan measure**：P–S 度；
- **Bowen–Margulis measure**：BM 测度；
- **loxodromic/elliptic/parabolic**：双曲/椭圆/抛物（等距类型）。

## 118. BibTeX 条目模板

```bibtex
@book{Ratcliffe2006,
  author  = {Ratcliffe, John},
  title   = {Foundations of Hyperbolic Manifolds},
  edition = {2nd},
  year    = {2006},
  publisher = {Springer}
}
```

## 119. 贡献指南（简要）

- 约定：保持符号一致；新节按 5–10 小节为单位提交；给出最小工作示例与测试。
- 评审：优先检查数学正确性、数值稳定性与跨模型一致性；必要处附推导。

## 120. 版本 1.5 计划

- 补充插图（Klein/对偶角/反射构造）、交互式演示链接；
- 完成更多练习答案与若干证明细节；
- 小规模参考实现与数据集发布。

## 121. Cartan 几何视角：Klein 几何与 G/H 模型

- Klein 几何：以齐性空间 \(G/H\) 描述几何，其中双曲情形 \(G=\mathrm{PO}(1,n),\ H=\mathrm{O}(n)\)。
- Cartan 连接：在主丛 \(P\to M\) 上的 \(\mathfrak{g}\)-值 1-形式 \(\omega\) 使得 \((P,\omega)\) 局部与 \(G\) 的 Maurer–Cartan 形式等价；曲率 \(\Omega=\mathrm{d}\omega+\tfrac12[\omega,\omega]\) 编码偏离模型的量。
- CK 几何：在二次绝对给定下，局部等价于 Klein 模型，曲率常数确定为 \(-1,0,+1\)（退化极限作适当解释）。

## 122. 射影联络与 Tractor 演算（提纲）

- 射影结构：无挠联络的测地曲线类同胚（无参数）即射影等价类；Klein 模型给出具有测地为直线的射影结构。
- Thomas 连接与 Tractor：在射影结构上构造 Tractor 丛与连接，将射影不变量（如曲率、Schouten 张量）统一编码；CK 几何对应恒定的 Tractor 曲率类型。
- 角度/距离：由对偶绝对与交比恢复度量信息，可视为在射影结构上添加绝对后得到的"度量化"。

## 123. 积分几何与 Crofton 公式（Klein 模型）

- Crofton 原理：长度/面积可表示为对测地（直线）与集合的交数的积分。在 Klein 模型，测地集为单位球内所有弦。
- 二维长度：存在常数 \(C\) 使得曲线 \(\gamma\) 的长度 \(L(\gamma)= C \int N(\gamma,\ell)\,\mathrm{d}\mu(\ell)\)，其中 \(\mu\) 为等距不变测度。
- 体积与运动学公式：在常曲率空间（含双曲/椭圆）有 Hadwiger–Santaló 型 kinematic 公式；Klein 模型可由对称空间法推出。

## 124. 测地流的符号动力学与编码

- 马尔可夫划分：对共紧双曲曲面，存在测地流的马尔可夫划分，使其与子移位符号系统半共轭；闭测地 ↔ 原词。
- 熵与压力：通过符号动力系统计算拓扑熵、压力与平衡态，连接到第 72 节热力学形式主义。
- 长度谱：原词长度与几何长度成正比，导向第 66 节的素测地定理与 Zeta。

## 125. Busemann 凸性、度量凸性与 CAT 条件

- Busemann 凸性：对任意两点 \(x,y\) 与中点 \(m\)，\(d(z,m)\le \tfrac12(d(z,x)+d(z,y))\)；双曲空间满足强凸性。
- Hilbert 几何：严格凸且边界 \(C^2\) 时具有 Busemann 凸性，旗曲率负；二次边界回到 CK/双曲情形。
- CAT 比较：CK/双曲满足 CAT\((-1)\)；一般 Hilbert 几何通常不满足 CAT\((\kappa)\)。

## 126. 数值认证与误差界（距离/角度/交比）

- `acosh` 误差：当 \(z=1+\epsilon\) 时使用 \(\operatorname{arcosh}(1+\epsilon)\approx \sqrt{2\epsilon}\)；对大 \(z\) 用 \(\log(z+\sqrt{z^2-1})\)。
- 交比稳定化：采用中心化参数与 `log1p`，并对分子/分母做同阶缩放以减少消去。
- 区间算术：在近边界/近切时以区间方式评估上/下界，确保不变量（如三角不等式）在数值层面不被违反。

## 127. 精确谓词与鲁棒内核（几何运算）

- 谓词：点在测地半空间内、弦—绝对相交数、反射后点是否仍在域内等，均可用符号式/任意精度浮点或 Shewchuk 风格扩展浮点实现。
- 退化处理：对齐（snap rounding）与符号守恒的分支，保证拓扑一致性。
- 性能：在 GPU 上采用两层核（快速近似 + 置信度回退到高精度）。

## 128. 属性与变形测试（Property/Metamorphic Testing）

- 属性：
  - 等距保持：\(d(gx,gy)=d(x,y)\)。
  - 三角不等式：\(d(x,z)\le d(x,y)+d(y,z)\)。
  - Klein↔Poincaré 一致性：\(d_K(x,y)=d_P(\phi(x),\phi(y))\)。
- 变形：小幅仿射扰动后归一化应恢复原结果；接近欧氏极限时与欧氏距离一致（第 9 节）。

## 129. 复现、版本化与发布建议

- 随机种与数据快照固定；
- 记录依赖与平台信息；
- 采用语义化版本与变更日志，配合基准与回归测试；
- 提供跨模型 API 的最小可行实现与示例（第 109、115 节）。

## 130. 版本 1.6 计划

- 补充 Cartan/Tractor 的最小证明细节与例题；
- 增加 Crofton 与运动学公式的数值实验；
- 发布鲁棒内核与精确谓词的小型库，以及更多属性/变形测试集合。

## 131. 三维双曲模型与 PSL(2,\mathbb{C}) 的作用

- 模型：三维使用上半空间与球模型；上半空间坐标 \((z,t)\in\mathbb{C}\times\mathbb{R}_{>0}\)，度量 \(\mathrm{d}s^2=(|\mathrm{d}z|^2+\mathrm{d}t^2)/t^2\)。
- 群作用：\(\mathrm{PSL}(2,\mathbb{C})\) 通过 Möbius 变换扩展到 \(\mathbb{H}^3\) 的边界与内部，为三维等距群；抛物/椭圆/双曲分类与固定点/轴一致。
- Klein 视角：三维 Klein 模型中等距为保持单位二次型的 \(\mathrm{PO}(1,3)\) 的射影像，与 \(\mathrm{PSL}(2,\mathbb{C})\) 同构。

## 132. 凸核（convex core）与重整化体积（renormalized volume）

- 凸核：对非共紧三维双曲流形 \(M=\mathbb{H}^3/\Gamma\)，凸核为极限集的凸包在商下之像；几何上集中"主要体积与曲率"。
- 重整化体积：在无限体积情况下用边界截断与外展（Graham–Witten 框架）定义，反映 Teichmüller 边界数据；与曲面端的拟共形结构相关。

## 133. Quasi-Fuchsian 空间与 Bers 同时一致化

- 定义：\(\Gamma\subset \mathrm{PSL}(2,\mathbb{C})\) 为 quasi-Fuchsian 若边界极限集为 Jordan 曲线，商流形拓扑上为 \(S\times\mathbb{R}\)。
- Bers 定理：给定两端的 Riemann 结构（Teichmüller 点）唯一决定一个 quasi-Fuchsian 群（Bers 同时一致化）。
- 几何：凸核边界为曲率负的 pleated surface；曲率数据与端的拟共形结构对应。

## 134. Fenchel–Nielsen 坐标与地震（earthquakes）

- 裤子分解：曲面 \(S\) 的 Teichmüller 空间可用长度–扭转（Fenchel–Nielsen）坐标描述。
- 地震：沿测度叶层的"切割–滑移"变形给出 Teichmüller 空间上的等距（Thurston 地震定理）。
- 与 CK：在 Klein/Poincaré 模型中，地震的几何实现可视为在边界上施加拟共形映射并在内部延拓为等距同胚。

## 135. 圆打包与离散保角（Thurston–Andreev–Koebe）

- 圆打包定理：任意平面三角剖分可由一组互切圆实现；离散保角映射近似经典保角。
- 双曲几何：在 Poincaré 圆盘中，圆打包的圆为测地圆；打包权重给出离散曲率，离散统一化定理连接到双曲度量。
- 计算：通过迭代调半径（Yamabe flow 离散版）或 Ricci flow 型算法实现；可转 Klein 进行直线几何可视化。

## 136. 测地曲率与平行移动（Klein 与 Poincaré）

- Poincaré：Christoffel 符号显式，平行移动与测地曲率计算直接；
- Klein：测地为直线，但联络非零。可通过双曲面模型拉回给出平行移动矩阵；沿直线方向的切向分量保持，法向分量以 \(\tanh/\coth\) 规律变换（与第 39 节主曲率相呼应）。

## 137. 复/四元双曲几何与 CK 类比（概览）

- 复双曲：群 \(\mathrm{PU}(n,1)\) 作用于复球；度量为 Bergman 型；角度与距离有 Hermitian 形式的交比表达。
- 四元双曲：\(\mathrm{PSp}(n,1)\)；结构更为刚性。
- 射影类比：以适当的"绝对"与保持群在复/四元射影空间中定义 CK 类似框架（需注意非交换代数的技术细节）。

## 138. 3D 实现要点：\(\mathrm{PSL}(2,\mathbb{C})\) 数值与网格操作

- 数值稳定：用 polar/QR 分解保持行列式归一；以双数/复双数跟踪导数与敏感度；
- 网格：在上半空间进行射线行进与三角网裁剪；法向与曲率在欧氏与双曲几何之间有关系式（通过形算子转换）。
- 基本域：Ford 圆/球构造（抛物元的外切球），可视化 cusp 结构。

## 139. 可视化方案：球外壳与射线行进（\(\mathbb{H}^3\)）

- 球模型：将 \(\mathbb{H}^3\) 嵌入单位球；采用折射式射线行进（折射率 \(n(r)=2/(1-r^2)\)）近似；
- 上半空间：使用解析 geodesic 片段（半圆/竖线）拼接的光线路径；
- Klein：直线光线 + 非欧长度着色，交互便捷。

## 140. 版本 1.7 变更

- 新增 131–139 节：三维双曲与 \(\mathrm{PSL}(2,\mathbb{C})\)、凸核与重整化体积、QF/Bers、Fenchel–Nielsen/地震、圆打包、曲率与平行移动、复/四元双曲、3D 实现与可视化。
- 后续：补充三维示例与数据、圆打包与离散统一化的教学笔记、PSL(2,\mathbb{C}) 数值库链接。

## 141. 反射群、Coxeter 多面体与 Vinberg 算法

- Coxeter 群：由镜面反射生成，关系由二面角 \(\pi/m_{ij}\) 给出。双曲多面体满足 Gram 矩阵具有洛伦兹符号。
- Vinberg 算法：判定与构造双曲反射群与 Coxeter 多面体的递推方法；在 Klein 模型中镜面为欧式超平面，易于实现裁剪与迭代扩张。
- 应用：构造共紧/有限体积反射流形、基本域与铺砌。

## 142. 理想四面体体积、Lobachevsky 函数与二重对数

- 理想四面体：四顶点在理想边界，体积仅由一个二面角参数 \(\theta\) 决定：\(\mathrm{Vol}=\Lambda(\theta)+\Lambda(\theta)+\Lambda(\theta)\)（对称情形），其中 \(\Lambda\) 为 Lobachevsky 函数。
- 二重对数：一般体积可用 Bloch–Wigner 二重对数表达，与交比参数 \(z\) 相关。
- 计算：在上半空间模型用交比取值；数值上使用稳定的 dilog 实现与参数化避免支路切换。

## 143. Schläfli 微分公式与体积变分

- 对于多面体族，体积满足 \(\mathrm{d}\,\mathrm{Vol}=-\tfrac12\sum_i \ell_i\,\mathrm{d}\alpha_i\)（\(\ell_i\) 为棱长，\(\alpha_i\) 为二面角）；
- 理想与截顶情形有相应修正（以截面长度替代）。
- 用途：体积极值、形变刚性与数值优化（由角度步进积分体积）。

## 144. Andreev 与 Rivin 定理（3D 理想/实多面体）

- Andreev：给定二面角数据的必要充分条件以保证在 \(\mathbb{H}^3\) 存在凸多面体（顶点在有限处）。
- Rivin：理想多面体的刻画以平面图与角条件给出。
- 算法：基于角度优化与可行域投影求解多面体几何；Klein 中裁剪直观高效。

## 145. Thurston 双曲 Dehn 填充与 cusp 几何

- Dehn 填充：在 cusp 上以 \((p,q)\) 曲率对进行填充，对充分大 \(|p|+|q|\) 得到双曲结构（除有限例外）。
- cusp 形状参数：由扭曲平行四边形的复参数给出，决定填充长度与扭转。
- 工作流：先在理想三角化上求解配边方程，再以 Newton 法调整到目标 \((p,q)\) 填充（SnapPy 典型实现）。

## 146. 极小曲面与调和映射（\(\mathbb{H}^3\)）

- Sacks–Uhlenbeck/Eells–Sampson：存在性与正则性工具；负曲率有利于极小曲面存在。
- Hitchin–Harmonic：从表示到调和映射与能量泛函；在 QF 流形中极小曲面与边界拟共形数据相关联。
- 数值：基于离散极小曲面（cotan Laplacian）和障碍项的能量下降法。

## 147. 拟共形形变与 Ahlfors–Bers 理论

- Beltrami 方程 \(\bar\partial f=\mu\,\partial f\)，\(\|\mu\|_\infty<1\) 给出边界拟共形变形；
- Ahlfors–Bers：参数化 Kleinian 群的形变空间，与 Teichmüller 空间对应；Bers 同时一致化是其三维实例（第 133 节）。
- 计算：离散 Beltrami（三角网）与 quasi-Newton；保角误差与雅可比调控。

## 148. Schottky 群、Maskit 域与共形焊接

- Schottky：由圆反演生成的自由群；基本域为圆盘外并经反演对粘合。
- Maskit 域：参数空间的截面展示不同动力类型的分界。
- 焊接：将两圆域边界以拟共形焊接得到 Riemann 面；与 quasi-Fuchsian 建模相联。

## 149. Farey 镶嵌、连分数与测地编码

- Farey 图在上半平面模型提供理想三角剖分；
- 连分数展开与地理路径的转向序列一一对应；
- 编码可用于 geodesic flow 的符号动力学与快速近似路径。

## 150. SnapPy 工作流与度量量计算

- 管线：导入三角化 → 解配边一致性 → 体积/长度谱/回路 → Dehn 填充与再求解；
- 指标：理想四面体形参数、体积、最短闭测地长度；
- 交叉验证：与 Schläfli 变分积分对比、与解析体积（理想四面体）对比。

## 151. Chern–Simons 不变量与体积

- 在三维双曲流形上，体积与 Chern–Simons 不变量出现在复 Chern–Simons 作用中；
- 与截面与扭转角的积分相关；
- 物理联系：三维拓扑量子场论与量子不变量的几何极限。

## 152. AdS/dS 类比与 CK 变体

- 反德西特（AdS）与德西特（dS）几何可视为不同符号的常曲率伪黎曼模型；
- CK 变体：改变"绝对"的符号与类型得到相应的射影模型；
- 物理：时空因果、全息边界与测地的几何直观。

## 153. 圆图案（circle patterns）与离散统一化

- Bobenko–Springborn 功能：通过能量最小化实现给定交角的圆图案；
- 与双曲度量：在圆盘模型中，圆图案中心与半径决定离散曲率与度量；
- 应用：纹理映射、网格整形与离散保角参数化。

## 154. Ricci 流与离散 Ricci（曲面双曲化）

- Hamilton/Perelman：曲面 Ricci 流收敛到常曲率度量；
- 离散 Ricci：Yamabe/Ricci 流在三角网格上调半径达成离散常曲率；
- 与圆打包：二者在离散统一化中互为替代与互证。

## 155. 版本 1.8 变更

- 新增 141–154 节：反射群/多面体、体积与二重对数、Schläfli、Andreev/Rivin、Dehn 填充、极小曲面与调和映射、拟共形、Schottky/焊接、Farey/编码、SnapPy、Chern–Simons、AdS/dS、圆图案与离散 Ricci。
- 计划：补充三维算例与体积/长度基准脚本，完善形参数与二重对数的数值稳定实现。

## 156. 导航与交叉引用清单（建议）

- 结构导航：0–7（总论）→ 8–20（闭式/角度/模型互换）→ 21–40（边界/测度/群/证明）→ 41–70（证明纲要/动力/谱）→ 71–100（实现/应用/附录）→ 101–130（参考/索引/测试/发布）→ 131–155（3D 与形变）→ 156–170（收尾）。
- 交叉引用：
  - 距离：8, 33, 52, 92, 109；角度：11, 44, 93；体积：18, 25, 132, 142, 143。
  - 模型互换：14, 20, 24, 30, 68；群与反射：23, 34, 37, 138, 141。
  - 边界/测度：21, 22, 61–65；Hilbert：12, 62, 75；离散群：26, 66, 67, 83, 148。

## 157. 图/表建议与插图任务单

- 图（建议）：
  - Klein 模型测地、对偶角度示意（第 11、15 节）；
  - Klein↔Poincaré 映射几何直观（第 14 节）；
  - 边界与 Busemann 视界（第 21–22 节）；
  - 基本域/反射镜面（第 23、26、141 节）；
  - 三维 PSL(2,ℂ) 作用与凸核（第 131–133 节）。
- 表（建议）：
  - 模型比较表（第 94 节已给）补充高维与数值条件列；
  - 实验记录模板扩充（第 116 节）。

## 158. 风格与记号统一（最终约定）

- 记号：内积/范数默认欧氏；Lorentz 以内角标 L；齐次坐标列向量，点/直线对偶按 \(A, A^{-1}\)。
- 公式排版：行间公式优先；必要时用 \(\) 行内；长式分行。
- 代码/接口：统一使用 ```text 代码块标注；矩阵/向量大写/小写一致。

## 159. 练习答案提要（续选）

- 第 45 节：用 Poincaré 模型的三角恒等式与 Klein↔Poincaré 映射，验证 Klein 下三角计算与标准结果一致。
- 第 62 节：给出一个边界非 \(C^1\) 的凸域例子，说明 Hilbert 度量非 Gromov 超曲率；提示：多面体域的"角点"构造。
- 第 73 节：在紧曲面上用 Selberg 迹公式验证小特征值与短闭测地的对应关系（数值对比）。

## 160. 课程与项目大纲（12–16 周）

- 周 1–2：射影与交比、绝对与保持群（0–7, 11, 17）。
- 周 3–4：CK 距离与角度、模型互换（8–16, 20, 24）。
- 周 5–6：体积/角缺、边界/视界、Hilbert（18–22, 12）。
- 周 7–8：群与反射、Dirichlet 域、离散群（23, 26, 34, 37）。
- 周 9–10：谱/动力/熵（61–66, 72–74）。
- 周 11–12：实现与数值（30, 35, 52, 68, 76）。
- 选修专题：三维与 PSL(2,ℂ)、Dehn 填充、圆打包（131–155）。

## 161. 参考实现与基准（扩展）

- 语言：C++/Python（核心/原型），加速：CUDA/Metal（可选）。
- API：第 92、109、115 节为最小集合；补充批处理与梯度接口（学习/优化）。
- 基准：
  - 模型一致性（距离/角度/梯度）；
  - 反射群长度保持与闭环误差；
  - 三维基本域构造与体积/长度谱对齐（SnapPy 对比）。

## 162. 数据与算例清单（补充）

- 2D：规则 \(n\) 边形反射群、随机凸域（Hilbert 对照）、圆打包网格。
- 3D：理想四面体/截顶拼接、Ford 域、QF 样例（形参数与体积）。
- ML：树/层级图、小型知识图谱（双曲嵌入）。

## 163. 许可与版权建议

- 文档：CC BY 4.0；
- 代码：MIT/Apache-2.0；
- 数据：按源数据协议保持署名与传播。

## 164. 勘误与提交流程

- 提交格式：节号+标题+问题描述+期望修正；
- 验证：附最小复现实验或引用；
- 周期：每月合并更新，必要时热修复。

## 165. 术语索引（按拼音首字母，节号参照）

- 角度（11, 44, 93）；边界（21, 61–65）；测地（2, 8, 25）；等距（10, 23, 34, 37）。
- 反射（23, 141）；互换（14, 20, 24）；体积（18, 25, 132, 142–143）。
- 圆打包（135）；地震（134）；长度谱（66）；熵（61, 72）。

## 166. 常见问题扩展 II（实践）

- P：Klein 近边界数值不稳如何避免？
  - A：快度半径+Poincaré 互换+钳制与系列展开（35, 68, 76）。
- P：一般二次型实现角度？
  - A：对偶绝对交比（11, 33, 36, 93），归一化后计算再映回。
- P：如何验证实现？
  - A：属性/变形测试（128），与基准（161）。

## 167. 最终总结（一页版）

- 射影 + 绝对 + 交比 → 统一欧氏/双曲/椭圆；
- Klein 模型：直线测地、闭式易算；Poincaré：保角优雅，互换等距；
- 组态：边界/视界/测度/熵/谱构成动力学与分析学；
- 实践：鲁棒数值+反射生成+基本域+三维 PSL(2,ℂ)；
- 应用：凸射影/Hilbert、ML 嵌入、几何计算与可视化。

## 168. 版本 2.0 纲要

- 图表与交互完善；
- 更系统的证明细节与练习答案；
- 参考实现与数据仓库开源；
- 三维/拟共形/圆图案模块化教程。

## 169. 致谢（扩展）

- 对文档评审、勘误与实现贡献者表示感谢；
- 特别致谢开源社区与相关教材/工具的启发与支持。

## 170. 完结声明

本文档现阶段内容已闭环，覆盖理论—模型—数值—应用的主链路，可作为课程/研究/工程的统一参考。后续版本将按"版本 2.0 纲要"推进更新与维护。
